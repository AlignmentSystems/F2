/*! F2 - v1.2.1 - 06-24-2013 - See below for copyright and license */
!function(exports){if(!exports.F2||exports.F2_TESTING_MODE){/*!
    JSON.org requires the following notice to accompany json2:

    Copyright (c) 2002 JSON.org

    http://json.org

    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), 
    to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, 
    and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

    The Software shall be used for Good, not Evil.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
    IN THE SOFTWARE.
*/
"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(n){return 10>n?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;length>i;i+=1)"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;space>i;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),!function(exports){function init(){this._events=new Object}function configure(conf){conf&&(conf.delimiter&&(this.delimiter=conf.delimiter),conf.wildcard&&(this.wildcard=conf.wildcard),this.wildcard&&(this.listenerTree=new Object))}function EventEmitter(conf){this._events=new Object,configure.call(this,conf)}function searchListenerTree(handlers,type,tree,i){if(!tree)return[];var leaf,len,branch,xTree,xxTree,isolatedBranch,endReached,listeners=[],typeLength=type.length,currentType=type[i],nextType=type[i+1];if(i===typeLength&&tree._listeners){if("function"==typeof tree._listeners)return handlers&&handlers.push(tree._listeners),[tree];for(leaf=0,len=tree._listeners.length;len>leaf;leaf++)handlers&&handlers.push(tree._listeners[leaf]);return[tree]}if("*"===currentType||"**"===currentType||tree[currentType]){if("*"===currentType){for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i+1)));return listeners}if("**"===currentType){endReached=i+1===typeLength||i+2===typeLength&&"*"===nextType,endReached&&tree._listeners&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree,typeLength)));for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&("*"===branch||"**"===branch?(tree[branch]._listeners&&!endReached&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],typeLength))),listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i))):listeners=branch===nextType?listeners.concat(searchListenerTree(handlers,type,tree[branch],i+2)):listeners.concat(searchListenerTree(handlers,type,tree[branch],i)));return listeners}listeners=listeners.concat(searchListenerTree(handlers,type,tree[currentType],i+1))}if(xTree=tree["*"],xTree&&searchListenerTree(handlers,type,xTree,i+1),xxTree=tree["**"])if(typeLength>i){xxTree._listeners&&searchListenerTree(handlers,type,xxTree,typeLength);for(branch in xxTree)"_listeners"!==branch&&xxTree.hasOwnProperty(branch)&&(branch===nextType?searchListenerTree(handlers,type,xxTree[branch],i+2):branch===currentType?searchListenerTree(handlers,type,xxTree[branch],i+1):(isolatedBranch={},isolatedBranch[branch]=xxTree[branch],searchListenerTree(handlers,type,{"**":isolatedBranch},i+1)))}else xxTree._listeners?searchListenerTree(handlers,type,xxTree,typeLength):xxTree["*"]&&xxTree["*"]._listeners&&searchListenerTree(handlers,type,xxTree["*"],typeLength);return listeners}function growListenerTree(type,listener){type="string"==typeof type?type.split(this.delimiter):type.slice();for(var i=0,len=type.length;len>i+1;i++)if("**"===type[i]&&"**"===type[i+1])return;for(var tree=this.listenerTree,name=type.shift();name;){if(tree[name]||(tree[name]=new Object),tree=tree[name],0===type.length){if(tree._listeners){if("function"==typeof tree._listeners)tree._listeners=[tree._listeners,listener];else if(isArray(tree._listeners)&&(tree._listeners.push(listener),!tree._listeners.warned)){var m=defaultMaxListeners;"undefined"!=typeof this._events.maxListeners&&(m=this._events.maxListeners),m>0&&tree._listeners.length>m&&(tree._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",tree._listeners.length),console.trace())}}else tree._listeners=listener;return!0}name=type.shift()}return!0}var isArray=Array.isArray?Array.isArray:function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},defaultMaxListeners=10;EventEmitter.prototype.delimiter=".",EventEmitter.prototype.setMaxListeners=function(n){this._events||init.call(this),this._events.maxListeners=n},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(event,fn){return this.many(event,1,fn),this},EventEmitter.prototype.many=function(event,ttl,fn){function listener(){0===--ttl&&self.off(event,listener),fn.apply(this,arguments)}var self=this;if("function"!=typeof fn)throw new Error("many only accepts instances of Function");return listener._origin=fn,this.on(event,listener),self},EventEmitter.prototype.emit=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this._events.newListener)return!1;if(this._all){for(var l=arguments.length,args=new Array(l-1),i=1;l>i;i++)args[i-1]=arguments[i];for(i=0,l=this._all.length;l>i;i++)this.event=type,this._all[i].apply(this,args)}if("error"===type&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var handler;if(this.wildcard){handler=[];var ns="string"==typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else handler=this._events[type];if("function"==typeof handler){if(this.event=type,1===arguments.length)handler.call(this);else if(arguments.length>1)switch(arguments.length){case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(var l=arguments.length,args=new Array(l-1),i=1;l>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}return!0}if(handler){for(var l=arguments.length,args=new Array(l-1),i=1;l>i;i++)args[i-1]=arguments[i];for(var listeners=handler.slice(),i=0,l=listeners.length;l>i;i++)this.event=type,listeners[i].apply(this,args);return listeners.length>0||this._all}return this._all},EventEmitter.prototype.on=function(type,listener){if("function"==typeof type)return this.onAny(type),this;if("function"!=typeof listener)throw new Error("on only accepts instances of Function");if(this._events||init.call(this),this.emit("newListener",type,listener),this.wildcard)return growListenerTree.call(this,type,listener),this;if(this._events[type]){if("function"==typeof this._events[type])this._events[type]=[this._events[type],listener];else if(isArray(this._events[type])&&(this._events[type].push(listener),!this._events[type].warned)){var m=defaultMaxListeners;"undefined"!=typeof this._events.maxListeners&&(m=this._events.maxListeners),m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),console.trace())}}else this._events[type]=listener;return this},EventEmitter.prototype.onAny=function(fn){if(this._all||(this._all=[]),"function"!=typeof fn)throw new Error("onAny only accepts instances of Function");return this._all.push(fn),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(type,listener){if("function"!=typeof listener)throw new Error("removeListener only takes instances of Function");var handlers,leafs=[];if(this.wildcard){var ns="string"==typeof type?type.split(this.delimiter):type.slice();leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)}else{if(!this._events[type])return this;handlers=this._events[type],leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];if(handlers=leaf._listeners,isArray(handlers)){for(var position=-1,i=0,length=handlers.length;length>i;i++)if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}if(0>position)return this;this.wildcard?leaf._listeners.splice(position,1):this._events[type].splice(position,1),0===handlers.length&&(this.wildcard?delete leaf._listeners:delete this._events[type])}else(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener)&&(this.wildcard?delete leaf._listeners:delete this._events[type])}return this},EventEmitter.prototype.offAny=function(fn){var fns,i=0,l=0;if(fn&&this._all&&this._all.length>0){for(fns=this._all,i=0,l=fns.length;l>i;i++)if(fn===fns[i])return fns.splice(i,1),this}else this._all=[];return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(type){if(0===arguments.length)return!this._events||init.call(this),this;if(this.wildcard)for(var ns="string"==typeof type?type.split(this.delimiter):type.slice(),leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0),iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];leaf._listeners=null}else{if(!this._events[type])return this;this._events[type]=null}return this},EventEmitter.prototype.listeners=function(type){if(this.wildcard){var handlers=[],ns="string"==typeof type?type.split(this.delimiter):type.slice();return searchListenerTree.call(this,handlers,ns,this.listenerTree,0),handlers}return this._events||init.call(this),this._events[type]||(this._events[type]=[]),isArray(this._events[type])||(this._events[type]=[this._events[type]]),this._events[type]},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]},exports.EventEmitter2=EventEmitter}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof exports?exports:window),/*!
 * Øyvind Sean Kinsey and others require the following notice to accompany easyXDM:
 * 
 * http://easyxdm.net/
 * Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
function(window,document,location,setTimeout,decodeURIComponent,encodeURIComponent){function isHostMethod(object,property){var t=typeof object[property];return"function"==t||!("object"!=t||!object[property])||"unknown"==t}function isHostObject(object,property){return!("object"!=typeof object[property]||!object[property])}function isArray(o){return"[object Array]"===Object.prototype.toString.call(o)}function hasFlash(){try{var activeX=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return flashVersion=Array.prototype.slice.call(activeX.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),HAS_FLASH_THROTTLED_BUG=parseInt(flashVersion[0],10)>9&&parseInt(flashVersion[1],10)>0,activeX=null,!0}catch(notSupportedException){return!1}}function dom_onReady(){if(!domIsReady){domIsReady=!0;for(var i=0;i<domReadyQueue.length;i++)domReadyQueue[i]();domReadyQueue.length=0}}function whenReady(fn,scope){return domIsReady?(fn.call(scope),void 0):(domReadyQueue.push(function(){fn.call(scope)}),void 0)}function getParentObject(){var obj=parent;if(""!==namespace)for(var i=0,ii=namespace.split(".");i<ii.length;i++)obj=obj[ii[i]];return obj.easyXDM}function noConflict(ns){return window.easyXDM=_easyXDM,namespace=ns,namespace&&(IFRAME_PREFIX="easyXDM_"+namespace.replace(".","_")+"_"),easyXDM}function getDomainName(url){return url.match(reURI)[3]}function getPort(url){return url.match(reURI)[4]||""}function getLocation(url){var m=url.toLowerCase().match(reURI),proto=m[2],domain=m[3],port=m[4]||"";return("http:"==proto&&":80"==port||"https:"==proto&&":443"==port)&&(port=""),proto+"//"+domain+port}function resolveUrl(url){if(url=url.replace(reDoubleSlash,"$1/"),!url.match(/^(http||https):\/\//)){var path="/"===url.substring(0,1)?"":location.pathname;"/"!==path.substring(path.length-1)&&(path=path.substring(0,path.lastIndexOf("/")+1)),url=location.protocol+"//"+location.host+path+url}for(;reParent.test(url);)url=url.replace(reParent,"");return url}function appendQueryParameters(url,parameters){var hash="",indexOf=url.indexOf("#");-1!==indexOf&&(hash=url.substring(indexOf),url=url.substring(0,indexOf));var q=[];for(var key in parameters)parameters.hasOwnProperty(key)&&q.push(key+"="+encodeURIComponent(parameters[key]));return url+(useHash?"#":-1==url.indexOf("?")?"?":"&")+q.join("&")+hash}function undef(v){return"undefined"==typeof v}function apply(destination,source,noOverwrite){var member;for(var prop in source)source.hasOwnProperty(prop)&&(prop in destination?(member=source[prop],"object"==typeof member?apply(destination[prop],member,noOverwrite):noOverwrite||(destination[prop]=source[prop])):destination[prop]=source[prop]);return destination}function testForNamePropertyBug(){var form=document.body.appendChild(document.createElement("form")),input=form.appendChild(document.createElement("input"));input.name=IFRAME_PREFIX+"TEST"+channelId,HAS_NAME_PROPERTY_BUG=input!==form.elements[input.name],document.body.removeChild(form)}function createFrame(config){undef(HAS_NAME_PROPERTY_BUG)&&testForNamePropertyBug();var frame;HAS_NAME_PROPERTY_BUG?frame=document.createElement('<iframe name="'+config.props.name+'"/>'):(frame=document.createElement("IFRAME"),frame.name=config.props.name),frame.id=frame.name=config.props.name,delete config.props.name,config.onLoad&&on(frame,"load",config.onLoad),"string"==typeof config.container&&(config.container=document.getElementById(config.container)),config.container||(apply(frame.style,{position:"absolute",top:"-2000px"}),config.container=document.body);var src=config.props.src;return delete config.props.src,apply(frame,config.props),frame.border=frame.frameBorder=0,frame.allowTransparency=!0,config.container.appendChild(frame),frame.src=src,config.props.src=src,frame}function checkAcl(acl,domain){"string"==typeof acl&&(acl=[acl]);for(var re,i=acl.length;i--;)if(re=acl[i],re=new RegExp("^"==re.substr(0,1)?re:"^"+re.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),re.test(domain))return!0;return!1}function prepareTransportStack(config){var stackEls,protocol=config.protocol;if(config.isHost=config.isHost||undef(query.xdm_p),useHash=config.hash||!1,config.props||(config.props={}),config.isHost)config.remote=resolveUrl(config.remote),config.channel=config.channel||"default"+channelId++,config.secret=Math.random().toString(16).substring(2),undef(protocol)&&(getLocation(location.href)==getLocation(config.remote)?protocol="4":isHostMethod(window,"postMessage")||isHostMethod(document,"postMessage")?protocol="1":config.swf&&isHostMethod(window,"ActiveXObject")&&hasFlash()?protocol="6":"Gecko"===navigator.product&&"frameElement"in window&&-1==navigator.userAgent.indexOf("WebKit")?protocol="5":config.remoteHelper?(config.remoteHelper=resolveUrl(config.remoteHelper),protocol="2"):protocol="0");else if(config.channel=query.xdm_c,config.secret=query.xdm_s,config.remote=query.xdm_e,protocol=query.xdm_p,config.acl&&!checkAcl(config.acl,config.remote))throw new Error("Access denied for "+config.remote);switch(config.protocol=protocol,protocol){case"0":if(apply(config,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),config.isHost){if(!config.local){for(var image,domain=location.protocol+"//"+location.host,images=document.body.getElementsByTagName("img"),i=images.length;i--;)if(image=images[i],image.src.substring(0,domain.length)===domain){config.local=image.src;break}config.local||(config.local=window)}var parameters={xdm_c:config.channel,xdm_p:0};config.local===window?(config.usePolling=!0,config.useParent=!0,config.local=location.protocol+"//"+location.host+location.pathname+location.search,parameters.xdm_e=config.local,parameters.xdm_pa=1):parameters.xdm_e=resolveUrl(config.local),config.container&&(config.useResize=!1,parameters.xdm_po=1),config.remote=appendQueryParameters(config.remote,parameters)}else apply(config,{channel:query.xdm_c,remote:query.xdm_e,useParent:!undef(query.xdm_pa),usePolling:!undef(query.xdm_po),useResize:config.useParent?!1:config.useResize});stackEls=[new easyXDM.stack.HashTransport(config),new easyXDM.stack.ReliableBehavior({}),new easyXDM.stack.QueueBehavior({encode:!0,maxLength:4e3-config.remote.length}),new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"1":stackEls=[new easyXDM.stack.PostMessageTransport(config)];break;case"2":stackEls=[new easyXDM.stack.NameTransport(config),new easyXDM.stack.QueueBehavior,new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"3":stackEls=[new easyXDM.stack.NixTransport(config)];break;case"4":stackEls=[new easyXDM.stack.SameOriginTransport(config)];break;case"5":stackEls=[new easyXDM.stack.FrameElementTransport(config)];break;case"6":flashVersion||hasFlash(),stackEls=[new easyXDM.stack.FlashTransport(config)]}return stackEls.push(new easyXDM.stack.QueueBehavior({lazy:config.lazy,remove:!0})),stackEls}function chainStack(stackElements){for(var stackEl,defaults={incoming:function(message,origin){this.up.incoming(message,origin)},outgoing:function(message,recipient){this.down.outgoing(message,recipient)},callback:function(success){this.up.callback(success)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},i=0,len=stackElements.length;len>i;i++)stackEl=stackElements[i],apply(stackEl,defaults,!0),0!==i&&(stackEl.down=stackElements[i-1]),i!==len-1&&(stackEl.up=stackElements[i+1]);return stackEl}function removeFromStack(element){element.up.down=element.down,element.down.up=element.up,element.up=element.down=null}var HAS_NAME_PROPERTY_BUG,flashVersion,HAS_FLASH_THROTTLED_BUG,on,un,global=this,channelId=Math.floor(1e4*Math.random()),emptyFn=Function.prototype,reURI=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,reParent=/[\-\w]+\/\.\.\//,reDoubleSlash=/([^:])\/\//g,namespace="",easyXDM={},_easyXDM=window.easyXDM,IFRAME_PREFIX="easyXDM_",useHash=!1;if(isHostMethod(window,"addEventListener"))on=function(target,type,listener){target.addEventListener(type,listener,!1)},un=function(target,type,listener){target.removeEventListener(type,listener,!1)};else{if(!isHostMethod(window,"attachEvent"))throw new Error("Browser not supported");on=function(object,sEvent,fpNotify){object.attachEvent("on"+sEvent,fpNotify)},un=function(object,sEvent,fpNotify){object.detachEvent("on"+sEvent,fpNotify)}}var readyState,domIsReady=!1,domReadyQueue=[];if("readyState"in document?(readyState=document.readyState,domIsReady="complete"==readyState||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==readyState||"interactive"==readyState)):domIsReady=!!document.body,!domIsReady){if(isHostMethod(window,"addEventListener"))on(document,"DOMContentLoaded",dom_onReady);else if(on(document,"readystatechange",function(){"complete"==document.readyState&&dom_onReady()}),document.documentElement.doScroll&&window===top){var doScrollCheck=function(){if(!domIsReady){try{document.documentElement.doScroll("left")}catch(e){return setTimeout(doScrollCheck,1),void 0}dom_onReady()}};doScrollCheck()}on(window,"load",dom_onReady)}var query=function(input){input=input.substring(1).split("&");for(var pair,data={},i=input.length;i--;)pair=input[i].split("="),data[pair[0]]=decodeURIComponent(pair[1]);return data}(/xdm_e=/.test(location.search)?location.search:location.hash),getJSON=function(){var cached={},obj={a:[1,2,3]},json='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(obj).replace(/\s/g,"")===json?JSON:(Object.toJSON&&Object.toJSON(obj).replace(/\s/g,"")===json&&(cached.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(obj=json.evalJSON(),obj.a&&3===obj.a.length&&3===obj.a[2]&&(cached.parse=function(str){return str.evalJSON()})),cached.stringify&&cached.parse?(getJSON=function(){return cached},cached):null)};apply(easyXDM,{version:"2.4.15.118",query:query,stack:{},apply:apply,getJSONObject:getJSON,whenReady:whenReady,noConflict:noConflict}),easyXDM.DomHelper={on:on,un:un,requiresJSON:function(path){isHostObject(window,"JSON")||document.write('<script type="text/javascript" src="'+path+'"><'+"/script>")}},function(){var _map={};easyXDM.Fn={set:function(name,fn){_map[name]=fn},get:function(name,del){var fn=_map[name];return del&&delete _map[name],fn}}}(),easyXDM.Socket=function(config){var stack=chainStack(prepareTransportStack(config).concat([{incoming:function(message,origin){config.onMessage(message,origin)},callback:function(success){config.onReady&&config.onReady(success)}}])),recipient=getLocation(config.remote);this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},this.postMessage=function(message){stack.outgoing(message,recipient)},stack.init()},easyXDM.Rpc=function(config,jsonRpcConfig){if(jsonRpcConfig.local)for(var method in jsonRpcConfig.local)if(jsonRpcConfig.local.hasOwnProperty(method)){var member=jsonRpcConfig.local[method];"function"==typeof member&&(jsonRpcConfig.local[method]={method:member})}var stack=chainStack(prepareTransportStack(config).concat([new easyXDM.stack.RpcBehavior(this,jsonRpcConfig),{callback:function(success){config.onReady&&config.onReady(success)}}]));this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},stack.init()},easyXDM.stack.SameOriginTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send(message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:location.protocol+"//"+location.host+location.pathname,xdm_c:config.channel,xdm_p:4}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),easyXDM.Fn.set(config.channel,function(sendFn){return send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}})):(send=getParentObject().Fn.get(config.channel,!0)(function(msg){pub.up.incoming(msg,targetOrigin)}),setTimeout(function(){pub.up.callback(!0)},0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FlashTransport=function(config){function onMessage(message){setTimeout(function(){pub.up.incoming(message,targetOrigin)},0)}function addSwf(domain){var url=config.swf+"?host="+config.isHost,id="easyXDM_swf_"+Math.floor(1e4*Math.random());easyXDM.Fn.set("flash_loaded"+domain.replace(/[\-.]/g,"_"),function(){easyXDM.stack.FlashTransport[domain].swf=swf=swfContainer.firstChild;for(var queue=easyXDM.stack.FlashTransport[domain].queue,i=0;i<queue.length;i++)queue[i]();queue.length=0}),config.swfContainer?swfContainer="string"==typeof config.swfContainer?document.getElementById(config.swfContainer):config.swfContainer:(swfContainer=document.createElement("div"),apply(swfContainer.style,HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),document.body.appendChild(swfContainer));var flashVars="callback=flash_loaded"+domain.replace(/[\-.]/g,"_")+"&proto="+global.location.protocol+"&domain="+getDomainName(global.location.href)+"&port="+getPort(global.location.href)+"&ns="+namespace;swfContainer.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+id+"' data='"+url+"'>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='wmode' value='transparent'>"+"<param name='movie' value='"+url+"'></param>"+"<param name='flashvars' value='"+flashVars+"'></param>"+"<embed type='application/x-shockwave-flash' FlashVars='"+flashVars+"' allowScriptAccess='always' wmode='transparent' src='"+url+"' height='1' width='1'></embed>"+"</object>"}var pub,frame,targetOrigin,swf,swfContainer;return pub={outgoing:function(message,domain,fn){swf.postMessage(config.channel,message.toString()),fn&&fn()},destroy:function(){try{swf.destroyChannel(config.channel)}catch(e){}swf=null,frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=config.remote,easyXDM.Fn.set("flash_"+config.channel+"_init",function(){setTimeout(function(){pub.up.callback(!0)})}),easyXDM.Fn.set("flash_"+config.channel+"_onMessage",onMessage),config.swf=resolveUrl(config.swf);var swfdomain=getDomainName(config.swf),fn=function(){easyXDM.stack.FlashTransport[swfdomain].init=!0,swf=easyXDM.stack.FlashTransport[swfdomain].swf,swf.createChannel(config.channel,config.secret,getLocation(config.remote),config.isHost),config.isHost&&(HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle&&apply(config.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:6,xdm_s:config.secret}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config))};easyXDM.stack.FlashTransport[swfdomain]&&easyXDM.stack.FlashTransport[swfdomain].init?fn():easyXDM.stack.FlashTransport[swfdomain]?easyXDM.stack.FlashTransport[swfdomain].queue.push(fn):(easyXDM.stack.FlashTransport[swfdomain]={queue:[fn]},addSwf(swfdomain))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.PostMessageTransport=function(config){function _getOrigin(event){if(event.origin)return getLocation(event.origin);if(event.uri)return getLocation(event.uri);if(event.domain)return location.protocol+"//"+event.domain;throw"Unable to retrieve the origin of the event"}function _window_onMessage(event){var origin=_getOrigin(event);origin==targetOrigin&&event.data.substring(0,config.channel.length+1)==config.channel+" "&&pub.up.incoming(event.data.substring(config.channel.length+1),origin)}var pub,frame,callerWindow,targetOrigin;return pub={outgoing:function(message,domain,fn){callerWindow.postMessage(config.channel+" "+message,domain||targetOrigin),fn&&fn()},destroy:function(){un(window,"message",_window_onMessage),frame&&(callerWindow=null,frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){if(targetOrigin=getLocation(config.remote),config.isHost){var waitForReady=function(event){event.data==config.channel+"-ready"&&(callerWindow="postMessage"in frame.contentWindow?frame.contentWindow:frame.contentWindow.document,un(window,"message",waitForReady),on(window,"message",_window_onMessage),setTimeout(function(){pub.up.callback(!0)},0))};on(window,"message",waitForReady),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:1}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config)}else on(window,"message",_window_onMessage),callerWindow="postMessage"in window.parent?window.parent:window.parent.document,callerWindow.postMessage(config.channel+"-ready",targetOrigin),setTimeout(function(){pub.up.callback(!0)},0)},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FrameElementTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send.call(this,message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:5}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),frame.fn=function(sendFn){return delete frame.fn,send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}}):(document.referrer&&getLocation(document.referrer)!=query.xdm_e&&(window.top.location=query.xdm_e),send=window.frameElement.fn(function(msg){pub.up.incoming(msg,targetOrigin)}),pub.up.callback(!0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.NameTransport=function(config){function _sendMessage(message){var url=config.remoteHelper+(isHost?"#_3":"#_2")+config.channel;callerWindow.contentWindow.sendMessage(message,url)}function _onReady(){isHost?2!==++readyCount&&isHost||pub.up.callback(!0):(_sendMessage("ready"),pub.up.callback(!0))}function _onMessage(message){pub.up.incoming(message,remoteOrigin)}function _onLoad(){callback&&setTimeout(function(){callback(!0)},0)}var pub,isHost,callerWindow,remoteWindow,readyCount,callback,remoteOrigin,remoteUrl;return pub={outgoing:function(message,domain,fn){callback=fn,_sendMessage(message)},destroy:function(){callerWindow.parentNode.removeChild(callerWindow),callerWindow=null,isHost&&(remoteWindow.parentNode.removeChild(remoteWindow),remoteWindow=null)},onDOMReady:function(){isHost=config.isHost,readyCount=0,remoteOrigin=getLocation(config.remote),config.local=resolveUrl(config.local),isHost?(easyXDM.Fn.set(config.channel,function(message){isHost&&"ready"===message&&(easyXDM.Fn.set(config.channel,_onMessage),_onReady())}),remoteUrl=appendQueryParameters(config.remote,{xdm_e:config.local,xdm_c:config.channel,xdm_p:2}),apply(config.props,{src:remoteUrl+"#"+config.channel,name:IFRAME_PREFIX+config.channel+"_provider"}),remoteWindow=createFrame(config)):(config.remoteHelper=config.remote,easyXDM.Fn.set(config.channel,_onMessage)),callerWindow=createFrame({props:{src:config.local+"#_4"+config.channel},onLoad:function onLoad(){var w=callerWindow||this;un(w,"load",onLoad),easyXDM.Fn.set(config.channel+"_load",_onLoad),function test(){"function"==typeof w.contentWindow.sendMessage?_onReady():setTimeout(test,50)}()}})},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.HashTransport=function(config){function _sendMessage(message){if(_callerWindow){var url=config.remote+"#"+_msgNr++ +"_"+message;(isHost||!useParent?_callerWindow.contentWindow:_callerWindow).location=url}}function _handleHash(hash){_lastMsg=hash,pub.up.incoming(_lastMsg.substring(_lastMsg.indexOf("_")+1),_remoteOrigin)}function _pollHash(){if(_listenerWindow){var href=_listenerWindow.location.href,hash="",indexOf=href.indexOf("#");-1!=indexOf&&(hash=href.substring(indexOf)),hash&&hash!=_lastMsg&&_handleHash(hash)}}function _attachListeners(){_timer=setInterval(_pollHash,pollInterval)}var pub,isHost,_timer,pollInterval,_lastMsg,_msgNr,_listenerWindow,_callerWindow,useParent,_remoteOrigin;return pub={outgoing:function(message){_sendMessage(message)},destroy:function(){window.clearInterval(_timer),(isHost||!useParent)&&_callerWindow.parentNode.removeChild(_callerWindow),_callerWindow=null},onDOMReady:function(){if(isHost=config.isHost,pollInterval=config.interval,_lastMsg="#"+config.channel,_msgNr=0,useParent=config.useParent,_remoteOrigin=getLocation(config.remote),isHost){if(config.props={src:config.remote,name:IFRAME_PREFIX+config.channel+"_provider"},useParent)config.onLoad=function(){_listenerWindow=window,_attachListeners(),pub.up.callback(!0)};else{var tries=0,max=config.delay/50;!function getRef(){if(++tries>max)throw new Error("Unable to reference listenerwindow");try{_listenerWindow=_callerWindow.contentWindow.frames[IFRAME_PREFIX+config.channel+"_consumer"]}catch(ex){}_listenerWindow?(_attachListeners(),pub.up.callback(!0)):setTimeout(getRef,50)}()}_callerWindow=createFrame(config)}else _listenerWindow=window,_attachListeners(),useParent?(_callerWindow=parent,pub.up.callback(!0)):(apply(config,{props:{src:config.remote+"#"+config.channel+new Date,name:IFRAME_PREFIX+config.channel+"_consumer"},onLoad:function(){pub.up.callback(!0)}}),_callerWindow=createFrame(config))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.ReliableBehavior=function(){var pub,callback,idOut=0,idIn=0,currentMessage="";return pub={incoming:function(message,origin){var indexOf=message.indexOf("_"),ack=message.substring(0,indexOf).split(",");message=message.substring(indexOf+1),ack[0]==idOut&&(currentMessage="",callback&&callback(!0)),message.length>0&&(pub.down.outgoing(ack[1]+","+idOut+"_"+currentMessage,origin),idIn!=ack[1]&&(idIn=ack[1],pub.up.incoming(message,origin)))},outgoing:function(message,origin,fn){currentMessage=message,callback=fn,pub.down.outgoing(idIn+","+ ++idOut+"_"+message,origin)}}},easyXDM.stack.QueueBehavior=function(config){function dispatch(){if(config.remove&&0===queue.length)return removeFromStack(pub),void 0;if(!waiting&&0!==queue.length&&!destroying){waiting=!0;var message=queue.shift();pub.down.outgoing(message.data,message.origin,function(success){waiting=!1,message.callback&&setTimeout(function(){message.callback(success)},0),dispatch()})}}var pub,destroying,queue=[],waiting=!0,incoming="",maxLength=0,lazy=!1,doFragment=!1;return pub={init:function(){undef(config)&&(config={}),config.maxLength&&(maxLength=config.maxLength,doFragment=!0),config.lazy?lazy=!0:pub.down.init()},callback:function(success){waiting=!1;var up=pub.up;dispatch(),up.callback(success)},incoming:function(message,origin){if(doFragment){var indexOf=message.indexOf("_"),seq=parseInt(message.substring(0,indexOf),10);incoming+=message.substring(indexOf+1),0===seq&&(config.encode&&(incoming=decodeURIComponent(incoming)),pub.up.incoming(incoming,origin),incoming="")}else pub.up.incoming(message,origin)},outgoing:function(message,origin,fn){config.encode&&(message=encodeURIComponent(message));var fragment,fragments=[];if(doFragment){for(;0!==message.length;)fragment=message.substring(0,maxLength),message=message.substring(fragment.length),fragments.push(fragment);for(;fragment=fragments.shift();)queue.push({data:fragments.length+"_"+fragment,origin:origin,callback:0===fragments.length?fn:null})}else queue.push({data:message,origin:origin,callback:fn});lazy?pub.down.init():dispatch()},destroy:function(){destroying=!0,pub.down.destroy()}}},easyXDM.stack.VerifyBehavior=function(config){function startVerification(){mySecret=Math.random().toString(16).substring(2),pub.down.outgoing(mySecret)}var pub,mySecret,theirSecret;return pub={incoming:function(message,origin){var indexOf=message.indexOf("_");-1===indexOf?message===mySecret?pub.up.callback(!0):theirSecret||(theirSecret=message,config.initiate||startVerification(),pub.down.outgoing(message)):message.substring(0,indexOf)===theirSecret&&pub.up.incoming(message.substring(indexOf+1),origin)},outgoing:function(message,origin,fn){pub.down.outgoing(mySecret+"_"+message,origin,fn)},callback:function(){config.initiate&&startVerification()}}},easyXDM.stack.RpcBehavior=function(proxy,config){function _send(data){data.jsonrpc="2.0",pub.down.outgoing(serializer.stringify(data))}function _createMethod(definition,method){var slice=Array.prototype.slice;return function(){var callback,l=arguments.length,message={method:method};l>0&&"function"==typeof arguments[l-1]?(l>1&&"function"==typeof arguments[l-2]?(callback={success:arguments[l-2],error:arguments[l-1]},message.params=slice.call(arguments,0,l-2)):(callback={success:arguments[l-1]},message.params=slice.call(arguments,0,l-1)),_callbacks[""+ ++_callbackCounter]=callback,message.id=_callbackCounter):message.params=slice.call(arguments,0),definition.namedParams&&1===message.params.length&&(message.params=message.params[0]),_send(message)}}function _executeMethod(method,id,fn,params){if(!fn)return id&&_send({id:id,error:{code:-32601,message:"Procedure not found."}}),void 0;var success,error;id?(success=function(result){success=emptyFn,_send({id:id,result:result})},error=function(message,data){error=emptyFn;var msg={id:id,error:{code:-32099,message:message}};data&&(msg.error.data=data),_send(msg)}):success=error=emptyFn,isArray(params)||(params=[params]);try{var result=fn.method.apply(fn.scope,params.concat([success,error]));undef(result)||success(result)}catch(ex1){error(ex1.message)}}var pub,serializer=config.serializer||getJSON(),_callbackCounter=0,_callbacks={};return pub={incoming:function(message){var data=serializer.parse(message);if(data.method)config.handle?config.handle(data,_send):_executeMethod(data.method,data.id,config.local[data.method],data.params);else{var callback=_callbacks[data.id];data.error?callback.error&&callback.error(data.error):callback.success&&callback.success(data.result),delete _callbacks[data.id]}},init:function(){if(config.remote)for(var method in config.remote)config.remote.hasOwnProperty(method)&&(proxy[method]=_createMethod(config.remote[method],method));pub.down.init()},destroy:function(){for(var method in config.remote)config.remote.hasOwnProperty(method)&&proxy.hasOwnProperty(method)&&delete proxy[method];pub.down.destroy()}}},global.easyXDM=easyXDM}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);/*!
 * F2 v1.2.1
 * Copyright (c) 2013 Markit On Demand, Inc. http://www.openf2.org
 *
 * "F2" is licensed under the Apache License, Version 2.0 (the "License"); 
 * you may not use this file except in compliance with the License. 
 * You may obtain a copy of the License at:
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed 
 * under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR 
 * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * Please note that F2 ("Software") may contain third party material that Markit 
 * On Demand Inc. has a license to use and include within the Software (the 
 * "Third Party Material"). A list of the software comprising the Third Party Material 
 * and the terms and conditions under which such Third Party Material is distributed 
 * are reproduced in the ThirdPartyMaterial.md file available at:
 * 
 * https://github.com/OpenF2/F2/blob/master/ThirdPartyMaterial.md
 * 
 * The inclusion of the Third Party Material in the Software does not grant, provide 
 * nor result in you having acquiring any rights whatsoever, other than as stipulated 
 * in the terms and conditions related to the specific Third Party Material, if any.
 *
 */
var F2;F2=function(){var _absolutizeURI=function(base,href){function removeDotSegments(input){var output=[];return input.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(p){"/.."===p?output.pop():output.push(p)}),output.join("").replace(/^\//,"/"===input.charAt(0)?"/":"")}return href=_parseURI(href||""),base=_parseURI(base||""),href&&base?(href.protocol||base.protocol)+(href.protocol||href.authority?href.authority:base.authority)+removeDotSegments(href.protocol||href.authority||"/"===href.pathname.charAt(0)?href.pathname:href.pathname?(base.authority&&!base.pathname?"/":"")+base.pathname.slice(0,base.pathname.lastIndexOf("/")+1)+href.pathname:base.pathname)+(href.protocol||href.authority||href.pathname?href.search:href.search||base.search)+href.hash:null},_parseURI=function(url){var m=String(url).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return m?{href:m[0]||"",protocol:m[1]||"",authority:m[2]||"",host:m[3]||"",hostname:m[4]||"",port:m[5]||"",pathname:m[6]||"",search:m[7]||"",hash:m[8]||""}:null};return{appConfigReplacer:function(key,value){return"root"==key||"ui"==key||"height"==key?void 0:value},Apps:{},extend:function(ns,obj,overwrite){var isFunc="function"==typeof obj,parts=ns?ns.split("."):[],parent=this;obj=obj||{},"F2"===parts[0]&&(parts=parts.slice(1));for(var i=0,len=parts.length;len>i;i++)parent[parts[i]]||(parent[parts[i]]=isFunc&&i+1==len?obj:{}),parent=parent[parts[i]];if(!isFunc)for(var prop in obj)("undefined"==typeof parent[prop]||overwrite)&&(parent[prop]=obj[prop]);return parent},guid:function(){var S4=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()},inArray:function(value,array){return jQuery.inArray(value,array)>-1},isLocalRequest:function(url){var ajaxLocation,ajaxLocParts,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,urlLower=url.toLowerCase(),parts=rurl.exec(urlLower);try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocation=ajaxLocation.toLowerCase(),parts||(urlLower=_absolutizeURI(ajaxLocation,urlLower).toLowerCase(),parts=rurl.exec(urlLower)),ajaxLocParts=rurl.exec(ajaxLocation)||[];var matched=!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||("http:"===parts[1]?"80":"443"))!==(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?"80":"443"))));return matched},isNativeDOMNode:function(testObject){var bIsNode="object"==typeof Node?testObject instanceof Node:testObject&&"object"==typeof testObject&&"number"==typeof testObject.nodeType&&"string"==typeof testObject.nodeName,bIsElement="object"==typeof HTMLElement?testObject instanceof HTMLElement:testObject&&"object"==typeof testObject&&1===testObject.nodeType&&"string"==typeof testObject.nodeName;return bIsNode||bIsElement},log:function(){window.console&&window.console.log&&console.log([].slice.call(arguments))},parse:function(str){return JSON.parse(str)},stringify:function(value,replacer,space){return JSON.stringify(value,replacer,space)},version:function(){return"{{sdk.version}}"}}}(),F2.extend("AppHandlers",function(){var _ct=F2.guid(),_f2t=F2.guid(),_handlerCollection={appCreateRoot:[],appRenderBefore:[],appDestroyBefore:[],appRenderAfter:[],appDestroyAfter:[],appRender:[],appDestroy:[]},_defaultMethods={appRender:function(appConfig,appHtml){var $root=null;F2.isNativeDOMNode(appConfig.root)?($root=jQuery(appConfig.root),$root.append(appHtml)):(appConfig.root=jQuery(appHtml).get(0),$root=jQuery(appConfig.root)),jQuery("body").append($root)},appDestroy:function(appInstance){appInstance&&appInstance.app&&appInstance.app.destroy&&"function"==typeof appInstance.app.destroy?appInstance.app.destroy():appInstance&&appInstance.app&&appInstance.app.destroy&&F2.log(appInstance.config.appId+" has a destroy property, but destroy is not of type function and as such will not be executed."),jQuery(appInstance.config.root).fadeOut(500,function(){jQuery(this).remove()})}},_createHandler=function(token,sNamespace,func_or_element,bDomNodeAppropriate){_validateToken(token);var handler={func:func_or_element,namespace:sNamespace,domNode:F2.isNativeDOMNode(func_or_element)?func_or_element:null};if(!handler.func&&!handler.domNode)throw"Invalid or null argument passed. Handler will not be added to collection. A valid dom element or callback function is required.";if(handler.domNode&&!bDomNodeAppropriate)throw"Invalid argument passed. Handler will not be added to collection. A callback function is required for this event type.";return handler},_validateToken=function(sToken){if(_ct!=sToken&&_f2t!=sToken)throw"Invalid token passed. Please verify that you have correctly received and stored token from F2.AppHandlers.getToken()."},_removeHandler=function(sToken,eventKey,sNamespace){if(_validateToken(sToken),sNamespace||eventKey)if(!sNamespace&&eventKey)_handlerCollection[eventKey]=[];else if(sNamespace&&!eventKey){sNamespace=sNamespace.toLowerCase();for(var currentEventKey in _handlerCollection){for(var eventCollection=_handlerCollection[currentEventKey],newEvents=[],i=0,ec=eventCollection.length;ec>i;i++){var currentEventHandler=eventCollection[i];currentEventHandler&&(currentEventHandler.namespace&&currentEventHandler.namespace.toLowerCase()==sNamespace||newEvents.push(currentEventHandler))}eventCollection=newEvents}}else if(sNamespace&&_handlerCollection[eventKey]){sNamespace=sNamespace.toLowerCase();for(var newHandlerCollection=[],iCounter=0,hc=_handlerCollection[eventKey].length;hc>iCounter;iCounter++){var currentHandler=_handlerCollection[eventKey][iCounter];currentHandler&&(currentHandler.namespace&&currentHandler.namespace.toLowerCase()==sNamespace||newHandlerCollection.push(currentHandler))}_handlerCollection[eventKey]=newHandlerCollection}};return{getToken:function(){return delete this.getToken,_ct},__f2GetToken:function(){return delete this.__f2GetToken,_f2t},__trigger:function(token,eventKey){if(token!=_f2t)throw"Token passed is invalid. Only F2 is allowed to call F2.AppHandlers.__trigger().";if(!_handlerCollection||!_handlerCollection[eventKey])throw"Invalid EventKey passed. Check your inputs and try again.";for(var passableArgs=[],i=2,j=arguments.length;j>i;i++)passableArgs.push(arguments[i]);if(0===_handlerCollection[eventKey].length&&_defaultMethods[eventKey])return _defaultMethods[eventKey].apply(F2,passableArgs),this;if(0===_handlerCollection[eventKey].length&&!_handlerCollection[eventKey])return this;for(var iCounter=0,hcl=_handlerCollection[eventKey].length;hcl>iCounter;iCounter++){var handler=_handlerCollection[eventKey][iCounter];if(handler.domNode&&arguments[2]&&arguments[2].root&&arguments[3]){var $appRoot=jQuery(arguments[2].root).append(arguments[3]);jQuery(handler.domNode).append($appRoot)}else handler.domNode&&arguments[2]&&!arguments[2].root&&arguments[3]?(arguments[2].root=jQuery(arguments[3]).get(0),jQuery(handler.domNode).append(arguments[2].root)):handler.func.apply(F2,passableArgs)}return this},on:function(token,eventKey,func_or_element){var sNamespace=null;if(!eventKey)throw"eventKey must be of type string and not null. For available appHandlers check F2.Constants.AppHandlers.";if(eventKey.indexOf(".")>-1){var arData=eventKey.split(".");eventKey=arData[0],sNamespace=arData[1]}if(!_handlerCollection||!_handlerCollection[eventKey])throw"Invalid EventKey passed. Check your inputs and try again.";return _handlerCollection[eventKey].push(_createHandler(token,sNamespace,func_or_element,"appRender"==eventKey)),this},off:function(token,eventKey){var sNamespace=null;if(!eventKey)throw"eventKey must be of type string and not null. For available appHandlers check F2.Constants.AppHandlers.";if(eventKey.indexOf(".")>-1){var arData=eventKey.split(".");eventKey=arData[0],sNamespace=arData[1]}if(!_handlerCollection||!_handlerCollection[eventKey])throw"Invalid EventKey passed. Check your inputs and try again.";return _removeHandler(token,eventKey,sNamespace),this}}}()),F2.extend("Constants",{AppHandlers:function(){return{APP_CREATE_ROOT:"appCreateRoot",APP_RENDER_BEFORE:"appRenderBefore",APP_RENDER:"appRender",APP_RENDER_AFTER:"appRenderAfter",APP_DESTROY_BEFORE:"appDestroyBefore",APP_DESTROY:"appDestroy",APP_DESTROY_AFTER:"appDestroyAfter"}}()}),F2.extend("",{App:function(){return{init:function(){}}},AppConfig:{appId:"",context:{},enableBatchRequests:!1,height:0,instanceId:"",isSecure:!1,manifestUrl:"",maxWidth:0,minGridSize:4,minWidth:300,name:"",root:void 0,ui:void 0,views:[]},AppManifest:{apps:[],inlineScripts:[],scripts:[],styles:[]},AppContent:{data:{},html:"",status:""},ContainerConfig:{afterAppRender:function(){},appRender:function(){},beforeAppRender:function(){},isSecureAppPage:!1,secureAppPagePath:"",supportedViews:[],UI:{Mask:{backgroundColor:"#FFF",loadingIcon:"",opacity:.6,useClasses:!1,zIndex:2}},xhr:{dataType:function(){},type:function(){},url:function(){}}}}),F2.extend("Constants",{Css:function(){var _PREFIX="f2-";return{APP:_PREFIX+"app",APP_CONTAINER:_PREFIX+"app-container",APP_TITLE:_PREFIX+"app-title",APP_VIEW:_PREFIX+"app-view",APP_VIEW_TRIGGER:_PREFIX+"app-view-trigger",MASK:_PREFIX+"mask",MASK_CONTAINER:_PREFIX+"mask-container"}}(),Events:function(){var _APP_EVENT_PREFIX="App.",_CONTAINER_EVENT_PREFIX="Container.";return{APP_SYMBOL_CHANGE:_APP_EVENT_PREFIX+"symbolChange",APP_WIDTH_CHANGE:_APP_EVENT_PREFIX+"widthChange.",CONTAINER_SYMBOL_CHANGE:_CONTAINER_EVENT_PREFIX+"symbolChange",CONTAINER_WIDTH_CHANGE:_CONTAINER_EVENT_PREFIX+"widthChange"}}(),JSONP_CALLBACK:"F2_jsonpCallback_",Sockets:{EVENT:"__event__",LOAD:"__socketLoad__",RPC:"__rpc__",RPC_CALLBACK:"__rpcCallback__",UI_RPC:"__uiRpc__"},Views:{DATA_ATTRIBUTE:"data-f2-view",ABOUT:"about",HELP:"help",HOME:"home",REMOVE:"remove",SETTINGS:"settings"}}),F2.extend("Events",function(){var _events=new EventEmitter2({wildcard:!0});return _events.setMaxListeners(0),{_socketEmit:function(){return EventEmitter2.prototype.emit.apply(_events,[].slice.call(arguments))},emit:function(){return F2.Rpc.broadcast(F2.Constants.Sockets.EVENT,[].slice.call(arguments)),EventEmitter2.prototype.emit.apply(_events,[].slice.call(arguments))},many:function(event,timesToListen,listener){return _events.many(event,timesToListen,listener)},off:function(event,listener){return _events.off(event,listener)},on:function(event,listener){return _events.on(event,listener)},once:function(event,listener){return _events.once(event,listener)}}}()),F2.extend("Rpc",function(){var _callbacks={},_secureAppPagePath="",_apps={},_rEvents=new RegExp("^"+F2.Constants.Sockets.EVENT),_rRpc=new RegExp("^"+F2.Constants.Sockets.RPC),_rRpcCallback=new RegExp("^"+F2.Constants.Sockets.RPC_CALLBACK),_rSocketLoad=new RegExp("^"+F2.Constants.Sockets.LOAD),_rUiCall=new RegExp("^"+F2.Constants.Sockets.UI_RPC),_createAppToContainerSocket=function(){var appConfig,isLoaded=!1,messagePlayback=[],socket=new easyXDM.Socket({onMessage:function(message,origin){if(!isLoaded&&_rSocketLoad.test(message)){message=message.replace(_rSocketLoad,"");var appParts=F2.parse(message);2==appParts.length&&(appConfig=appParts[0],_apps[appConfig.instanceId]={config:appConfig,socket:socket},F2.registerApps([appConfig],[appParts[1]]),jQuery.each(messagePlayback,function(){_onMessage(appConfig,message,origin)}),isLoaded=!0)}else isLoaded?_onMessage(appConfig,message,origin):messagePlayback.push(message)}})},_createContainerToAppSocket=function(appConfig,appManifest){var container=jQuery(appConfig.root);if(container.is("."+F2.Constants.Css.APP_CONTAINER)||container.find("."+F2.Constants.Css.APP_CONTAINER),!container.length)return F2.log("Unable to locate app in order to establish secure connection."),void 0;var iframeProps={scrolling:"no",style:{width:"100%"}};appConfig.height&&(iframeProps.style.height=appConfig.height+"px");var socket=new easyXDM.Socket({remote:_secureAppPagePath,container:container.get(0),props:iframeProps,onMessage:function(message,origin){_onMessage(appConfig,message,origin)},onReady:function(){socket.postMessage(F2.Constants.Sockets.LOAD+F2.stringify([appConfig,appManifest],F2.appConfigReplacer))}});return socket},_createRpcCallback=function(instanceId,callbackId){return function(){F2.Rpc.call(instanceId,F2.Constants.Sockets.RPC_CALLBACK,callbackId,[].slice.call(arguments).slice(2))}},_onMessage=function(appConfig,message){function parseFunction(parent,functionName){for(var path=String(functionName).split("."),i=0;i<path.length;i++){if(void 0===parent[path[i]]){parent=void 0;break}parent=parent[path[i]]}return parent}function parseMessage(regEx,message,instanceId){var o=F2.parse(message.replace(regEx,""));return o.params&&o.params.length&&o.callbacks&&o.callbacks.length&&jQuery.each(o.callbacks,function(i,c){jQuery.each(o.params,function(i,p){c==p&&(o.params[i]=_createRpcCallback(instanceId,c))})}),o}var obj,func;_rUiCall.test(message)?(obj=parseMessage(_rUiCall,message,appConfig.instanceId),func=parseFunction(appConfig.ui,obj.functionName),void 0!==func?func.apply(appConfig.ui,obj.params):F2.log("Unable to locate UI RPC function: "+obj.functionName)):_rRpc.test(message)?(obj=parseMessage(_rRpc,message,appConfig.instanceId),func=parseFunction(window,obj.functionName),void 0!==func?func.apply(func,obj.params):F2.log("Unable to locate RPC function: "+obj.functionName)):_rRpcCallback.test(message)?(obj=parseMessage(_rRpcCallback,message,appConfig.instanceId),void 0!==_callbacks[obj.functionName]&&(_callbacks[obj.functionName].apply(_callbacks[obj.functionName],obj.params),delete _callbacks[obj.functionName])):_rEvents.test(message)&&(obj=parseMessage(_rEvents,message,appConfig.instanceId),F2.Events._socketEmit.apply(F2.Events,obj))},_registerCallback=function(callback){var callbackId=F2.guid();return _callbacks[callbackId]=callback,callbackId};return{broadcast:function(messageType,params){var message=messageType+F2.stringify(params);jQuery.each(_apps,function(i,a){a.socket.postMessage(message)})},call:function(instanceId,messageType,functionName,params){var callbacks=[];jQuery.each(params,function(i,e){if("function"==typeof e){var cid=_registerCallback(e);params[i]=cid,callbacks.push(cid)}}),_apps[instanceId].socket.postMessage(messageType+F2.stringify({functionName:functionName,params:params,callbacks:callbacks}))},init:function(secureAppPagePath){_secureAppPagePath=secureAppPagePath,_secureAppPagePath||_createAppToContainerSocket()},isRemote:function(instanceId){return void 0!==_apps[instanceId]&&_apps[instanceId].config.isSecure&&0===jQuery(_apps[instanceId].config.root).find("iframe").length},register:function(appConfig,appManifest){appConfig&&appManifest?_apps[appConfig.instanceId]={config:appConfig,socket:_createContainerToAppSocket(appConfig,appManifest)}:F2.log("Unable to register socket connection. Please check container configuration.")}}}()),F2.extend("UI",function(){var _containerConfig,UI_Class=function(appConfig){var _appConfig=appConfig,$root=jQuery(appConfig.root),_updateHeight=function(height){height=height||jQuery(_appConfig.root).outerHeight(),F2.Rpc.isRemote(_appConfig.instanceId)?F2.Rpc.call(_appConfig.instanceId,F2.Constants.Sockets.UI_RPC,"updateHeight",[height]):(_appConfig.height=height,$root.find("iframe").height(_appConfig.height))};return{hideMask:function(selector){F2.UI.hideMask(_appConfig.instanceId,selector)},Modals:function(){var _renderAlert=function(message){return['<div class="modal">','<header class="modal-header">',"<h3>Alert!</h3>","</header>",'<div class="modal-body">',"<p>",message,"</p>","</div>",'<div class="modal-footer">','<button class="btn btn-primary btn-ok">OK</button>',"</div>","</div>"].join("")},_renderConfirm=function(message){return['<div class="modal">','<header class="modal-header">',"<h3>Confirm</h3>","</header>",'<div class="modal-body">',"<p>",message,"</p>","</div>",'<div class="modal-footer">','<button type="button" class="btn btn-primary btn-ok">OK</button>','<button type="button" class="btn btn-cancel">Cancel</button">',"</div>","</div>"].join("")};return{alert:function(message,callback){return F2.isInit()?(F2.Rpc.isRemote(_appConfig.instanceId)?F2.Rpc.call(_appConfig.instanceId,F2.Constants.Sockets.UI_RPC,"Modals.alert",[].slice.call(arguments)):jQuery(_renderAlert(message)).on("show",function(){var modal=this;jQuery(modal).find(".btn-primary").on("click",function(){jQuery(modal).modal("hide").remove(),(callback||jQuery.noop)()})}).modal({backdrop:!0}),void 0):(F2.log("F2.init() must be called before F2.UI.Modals.alert()"),void 0)},confirm:function(message,okCallback,cancelCallback){return F2.isInit()?(F2.Rpc.isRemote(_appConfig.instanceId)?F2.Rpc.call(_appConfig.instanceId,F2.Constants.Sockets.UI_RPC,"Modals.confirm",[].slice.call(arguments)):jQuery(_renderConfirm(message)).on("show",function(){var modal=this;jQuery(modal).find(".btn-ok").on("click",function(){jQuery(modal).modal("hide").remove(),(okCallback||jQuery.noop)()}),jQuery(modal).find(".btn-cancel").on("click",function(){jQuery(modal).modal("hide").remove(),(cancelCallback||jQuery.noop)()})}).modal({backdrop:!0}),void 0):(F2.log("F2.init() must be called before F2.UI.Modals.confirm()"),void 0)}}}(),setTitle:function(title){F2.Rpc.isRemote(_appConfig.instanceId)?F2.Rpc.call(_appConfig.instanceId,F2.Constants.Sockets.UI_RPC,"setTitle",[title]):jQuery(_appConfig.root).find("."+F2.Constants.Css.APP_TITLE).text(title)},showMask:function(selector,showLoader){F2.UI.showMask(_appConfig.instanceId,selector,showLoader)},updateHeight:_updateHeight,Views:function(){var _events=new EventEmitter2,_rValidEvents=/change/i;_events.setMaxListeners(0);var _isValid=function(eventName){return _rValidEvents.test(eventName)?!0:(F2.log('"'+eventName+'" is not a valid F2.UI.Views event name'),!1)};return{change:function(input){"function"==typeof input?this.on("change",input):"string"==typeof input&&(_appConfig.isSecure&&!F2.Rpc.isRemote(_appConfig.instanceId)?F2.Rpc.call(_appConfig.instanceId,F2.Constants.Sockets.UI_RPC,"Views.change",[].slice.call(arguments)):F2.inArray(input,_appConfig.views)&&(jQuery("."+F2.Constants.Css.APP_VIEW,$root).addClass("hide").filter('[data-f2-view="'+input+'"]',$root).removeClass("hide"),_updateHeight(),_events.emit("change",input)))},off:function(event,listener){_isValid(event)&&_events.off(event,listener)},on:function(event,listener){_isValid(event)&&_events.on(event,listener)}}}()}};return UI_Class.hideMask=function(instanceId,selector){if(!F2.isInit())return F2.log("F2.init() must be called before F2.UI.hideMask()"),void 0;if(F2.Rpc.isRemote(instanceId)&&!jQuery(selector).is("."+F2.Constants.Css.APP))F2.Rpc.call(instanceId,F2.Constants.Sockets.RPC,"F2.UI.hideMask",[instanceId,jQuery(selector).selector]);else{var container=jQuery(selector);container.find("> ."+F2.Constants.Css.MASK).remove(),container.removeClass(F2.Constants.Css.MASK_CONTAINER),container.data(F2.Constants.Css.MASK_CONTAINER)&&container.css({position:"static"})}},UI_Class.init=function(containerConfig){_containerConfig=containerConfig,_containerConfig.UI=jQuery.extend(!0,{},F2.ContainerConfig.UI,_containerConfig.UI||{})},UI_Class.showMask=function(instanceId,selector,showLoading){if(!F2.isInit())return F2.log("F2.init() must be called before F2.UI.showMask()"),void 0;if(F2.Rpc.isRemote(instanceId)&&jQuery(selector).is("."+F2.Constants.Css.APP))F2.Rpc.call(instanceId,F2.Constants.Sockets.RPC,"F2.UI.showMask",[instanceId,jQuery(selector).selector,showLoading]);else{showLoading&&!_containerConfig.UI.Mask.loadingIcon&&F2.log("Unable to display loading icon. Please set F2.ContainerConfig.UI.Mask.loadingIcon	when calling F2.init();");var container=jQuery(selector).addClass(F2.Constants.Css.MASK_CONTAINER),mask=jQuery("<div>").height("100%").width("100%").addClass(F2.Constants.Css.MASK);_containerConfig.UI.Mask.useClasses||mask.css({"background-color":_containerConfig.UI.Mask.backgroundColor,"background-image":_containerConfig.UI.Mask.loadingIcon?"url("+_containerConfig.UI.Mask.loadingIcon+")":"","background-position":"50% 50%","background-repeat":"no-repeat",display:"block",left:0,"min-height":30,padding:0,position:"absolute",top:0,"z-index":_containerConfig.UI.Mask.zIndex,filter:"alpha(opacity="+100*_containerConfig.UI.Mask.opacity+")",opacity:_containerConfig.UI.Mask.opacity}),"static"===container.css("position")&&(container.css({position:"relative"}),container.data(F2.Constants.Css.MASK_CONTAINER,!0)),container.append(mask)}},UI_Class}()),F2.extend("",function(){var _apps={},_config=!1,_bUsesAppHandlers=!1,_sAppHandlerToken=F2.AppHandlers.__f2GetToken(),_afterAppRender=function(appConfig,html){var handler=_config.afterAppRender||function(appConfig,html){return jQuery(html).appendTo("body")},appContainer=handler(appConfig,html);return _config.afterAppRender&&!appContainer?(F2.log("F2.ContainerConfig.afterAppRender() must return the DOM Element that contains the app"),void 0):(jQuery(appContainer).addClass(F2.Constants.Css.APP),appContainer.get(0))},_appRender=function(appConfig,html){return html=_outerHtml(jQuery(html).addClass(F2.Constants.Css.APP_CONTAINER+" "+appConfig.appId)),_config.appRender&&(html=_config.appRender(appConfig,html)),_outerHtml(html)},_beforeAppRender=function(appConfig){var handler=_config.beforeAppRender||jQuery.noop;return handler(appConfig)},_hydrateAppConfig=function(appConfig){appConfig.instanceId=appConfig.instanceId||F2.guid(),appConfig.views=appConfig.views||[],F2.inArray(F2.Constants.Views.HOME,appConfig.views)||appConfig.views.push(F2.Constants.Views.HOME)},_initAppEvents=function(appConfig){jQuery(appConfig.root).on("click","."+F2.Constants.Css.APP_VIEW_TRIGGER+"["+F2.Constants.Views.DATA_ATTRIBUTE+"]",function(event){event.preventDefault();var view=jQuery(this).attr(F2.Constants.Views.DATA_ATTRIBUTE).toLowerCase();view==F2.Constants.Views.REMOVE?F2.removeApp(appConfig.instanceId):appConfig.ui.Views.change(view)})},_initContainerEvents=function(){var resizeTimeout,resizeHandler=function(){F2.Events.emit(F2.Constants.Events.CONTAINER_WIDTH_CHANGE)};jQuery(window).on("resize",function(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(resizeHandler,100)})},_isInit=function(){return!!_config},_createAppInstance=function(appConfig,appContent){appConfig.ui=new F2.UI(appConfig),void 0!==F2.Apps[appConfig.appId]&&("function"==typeof F2.Apps[appConfig.appId]?setTimeout(function(){_apps[appConfig.instanceId].app=new F2.Apps[appConfig.appId](appConfig,appContent,appConfig.root),void 0!==_apps[appConfig.instanceId].app.init&&_apps[appConfig.instanceId].app.init()},0):F2.log("app initialization class is defined but not a function. ("+appConfig.appId+")"))},_loadApps=function(appConfigs,appManifest){if(appConfigs=[].concat(appConfigs),1==appConfigs.length&&appConfigs[0].isSecure&&!_config.isSecureAppPage)return _loadSecureApp(appConfigs[0],appManifest),void 0;if(appConfigs.length!=appManifest.apps.length)return F2.log("The number of apps defined in the AppManifest do not match the number requested.",appManifest),void 0;var scripts=appManifest.scripts||[],styles=appManifest.styles||[],inlines=appManifest.inlineScripts||[],scriptCount=scripts.length,scriptsLoaded=0,appInit=function(){jQuery.each(appConfigs,function(i,a){_createAppInstance(a,appManifest.apps[i])})},evalInlines=function(){jQuery.each(inlines,function(i,e){try{eval(e)}catch(exception){F2.log("Error loading inline script: "+exception+"\n\n"+e)}})},stylesFragment=null,useCreateStyleSheet=!!document.createStyleSheet;jQuery.each(styles,function(i,e){useCreateStyleSheet?document.createStyleSheet(e):(stylesFragment=stylesFragment||[],stylesFragment.push('<link rel="stylesheet" type="text/css" href="'+e+'"/>'))}),stylesFragment&&jQuery("head").append(stylesFragment.join("")),jQuery.each(appManifest.apps,function(i,a){if(_bUsesAppHandlers){F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_RENDER,appConfigs[i],_outerHtml(a.html));var appId=appConfigs[i].appId;if(!appConfigs[i].root)throw"Root for "+appId+" must be a native DOM element and cannot be null or undefined. Check your AppHandler callbacks to ensure you have set App root to a native DOM element.";var $root=jQuery(appConfigs[i].root);if(0===$root.parents("body:first").length)throw"App root for "+appId+" was not appended to the DOM. Check your AppHandler callbacks to ensure you have rendered the app root to the DOM.";if(F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_RENDER_AFTER,appConfigs[i]),!F2.isNativeDOMNode(appConfigs[i].root))throw"App root for "+appId+" must be a native DOM element. Check your AppHandler callbacks to ensure you have set app root to a native DOM element.";$root.addClass(F2.Constants.Css.APP_CONTAINER+" "+appId)}else appConfigs[i].root=_afterAppRender(appConfigs[i],_appRender(appConfigs[i],a.html));_initAppEvents(appConfigs[i])}),jQuery.each(scripts,function(i,e){jQuery.ajax({url:e,cache:!0,async:!1,dataType:"script",type:"GET",success:function(){++scriptsLoaded==scriptCount&&(evalInlines(),appInit())},error:function(jqxhr,settings,exception){F2.log(["Failed to load script ("+e+")",exception.toString()])}})}),scriptCount||(evalInlines(),appInit())},_loadSecureApp=function(appConfig,appManifest){if(_config.secureAppPagePath){if(_bUsesAppHandlers){var $root=jQuery(appConfig.root);if(F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_RENDER,appConfig,appManifest.html),0===$root.parents("body:first").length)throw"App was never rendered on the page. Please check your AppHandler callbacks to ensure you have rendered the app root to the DOM.";if(F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_RENDER_AFTER,appConfig),!appConfig.root)throw"App Root must be a native dom node and can not be null or undefined. Please check your AppHandler callbacks to ensure you have set App Root to a native dom node.";if(!F2.isNativeDOMNode(appConfig.root))throw"App Root must be a native dom node. Please check your AppHandler callbacks to ensure you have set App Root to a native dom node.";jQuery(appConfig.root).addClass(F2.Constants.Css.APP_CONTAINER+" "+appConfig.appId)}else appConfig.root=_afterAppRender(appConfig,_appRender(appConfig,"<div></div>"));appConfig.ui=new F2.UI(appConfig),_initAppEvents(appConfig),F2.Rpc.register(appConfig,appManifest)}else F2.log('Unable to load secure app: "secureAppPagePath" is not defined in F2.ContainerConfig.')},_outerHtml=function(html){return jQuery("<div></div>").append(html).html()},_validateApp=function(appConfig){return appConfig.appId?appConfig.root||appConfig.manifestUrl?!0:(F2.log('"manifestUrl" missing from app object'),!1):(F2.log('"appId" missing from app object'),!1)},_validateContainerConfig=function(){if(_config&&_config.xhr){if("function"!=typeof _config.xhr&&"object"!=typeof _config.xhr)throw"ContainerConfig.xhr should be a function or an object";if(_config.xhr.dataType&&"function"!=typeof _config.xhr.dataType)throw"ContainerConfig.xhr.dataType should be a function";if(_config.xhr.type&&"function"!=typeof _config.xhr.type)throw"ContainerConfig.xhr.type should be a function";if(_config.xhr.url&&"function"!=typeof _config.xhr.url)throw"ContainerConfig.xhr.url should be a function"}return!0};return{getContainerState:function(){return _isInit()?jQuery.map(_apps,function(app){return{appId:app.config.appId}}):(F2.log("F2.init() must be called before F2.getContainerState()"),void 0)},init:function(config){_config=config||{},_validateContainerConfig(),_bUsesAppHandlers=!_config.beforeAppRender&&!_config.appRender&&!_config.afterAppRender,(_config.secureAppPagePath||_config.isSecureAppPage)&&F2.Rpc.init(_config.secureAppPagePath?_config.secureAppPagePath:!1),F2.UI.init(_config),_config.isSecureAppPage||_initContainerEvents()},isInit:_isInit,registerApps:function(appConfigs,appManifests){if(!_isInit())return F2.log("F2.init() must be called before F2.registerApps()"),void 0;if(!appConfigs)return F2.log("At least one AppConfig must be passed when calling F2.registerApps()"),void 0;var appStack=[],batches={},callbackStack={},haveManifests=!1;return appConfigs=[].concat(appConfigs),appManifests=[].concat(appManifests||[]),haveManifests=!!appManifests.length,appConfigs.length?appConfigs.length&&haveManifests&&appConfigs.length!=appManifests.length?(F2.log('The length of "apps" does not equal the length of "appManifests"'),void 0):(jQuery.each(appConfigs,function(i,a){if(_hydrateAppConfig(a),a.root=a.root||null,_validateApp(a)){if(_apps[a.instanceId]={config:a},a.root){if(!a.root&&"string"!=typeof a.root&&!F2.isNativeDOMNode(a.root))throw F2.log("AppConfig invalid for pre-load, not a valid string and not dom node"),F2.log("AppConfig instance:",a),"Preloaded appConfig.root property must be a native dom node or a string representing a sizzle selector. Please check your inputs and try again.";if(1!=jQuery(a.root).length)throw F2.log("AppConfig invalid for pre-load, root not unique"),F2.log("AppConfig instance:",a),F2.log("Number of dom node instances:",jQuery(a.root).length),"Preloaded appConfig.root property must map to a unique dom node. Please check your inputs and try again.";return _createAppInstance(a),_initAppEvents(a),void 0}_bUsesAppHandlers?(F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_CREATE_ROOT,a),F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_RENDER_BEFORE,a)):a.root=_beforeAppRender(a),haveManifests?_loadApps(a,appManifests[i]):a.enableBatchRequests&&!a.isSecure?(batches[a.manifestUrl.toLowerCase()]=batches[a.manifestUrl.toLowerCase()]||[],batches[a.manifestUrl.toLowerCase()].push(a)):appStack.push({apps:[a],url:a.manifestUrl})}}),haveManifests||(jQuery.each(batches,function(i,b){appStack.push({url:i,apps:b})}),jQuery.each(appStack,function(i,req){var jsonpCallback=F2.Constants.JSONP_CALLBACK+req.apps[0].appId;callbackStack[jsonpCallback]=callbackStack[jsonpCallback]||[],callbackStack[jsonpCallback].push(req)}),jQuery.each(callbackStack,function(i,requests){var manifestRequest=function(jsonpCallback,req){if(req){var url=req.url,type="GET",dataType="jsonp",completeFunc=function(){manifestRequest(i,requests.pop())},errorFunc=function(){jQuery.each(req.apps,function(idx,item){F2.log("Removed failed "+item.name+" app",item),F2.removeApp(item.instanceId)})},successFunc=function(appManifest){_loadApps(req.apps,appManifest)};if(_config.xhr&&_config.xhr.dataType&&(dataType=_config.xhr.dataType(req.url,req.apps),"string"!=typeof dataType))throw"ContainerConfig.xhr.dataType should return a string";if(_config.xhr&&_config.xhr.type&&(type=_config.xhr.type(req.url,req.apps),"string"!=typeof type))throw"ContainerConfig.xhr.type should return a string";if(_config.xhr&&_config.xhr.url&&(url=_config.xhr.url(req.url,req.apps),"string"!=typeof url))throw"ContainerConfig.xhr.url should return a string";var requestFunc=_config.xhr;"function"!=typeof requestFunc&&(requestFunc=function(url,appConfigs,successCallback,errorCallback,completeCallback){jQuery.ajax({url:url,type:type,data:{params:F2.stringify(req.apps,F2.appConfigReplacer)},jsonp:!1,jsonpCallback:jsonpCallback,dataType:dataType,success:successCallback,error:function(jqxhr,settings,exception){F2.log("Failed to load app(s)",exception.toString(),req.apps),errorCallback()},complete:completeCallback})}),requestFunc(url,req.apps,successFunc,errorFunc,completeFunc)}};manifestRequest(i,requests.pop())})),void 0):(F2.log("At least one AppConfig must be passed when calling F2.registerApps()"),void 0)},removeAllApps:function(){return _isInit()?(jQuery.each(_apps,function(i,a){F2.removeApp(a.config.instanceId)}),void 0):(F2.log("F2.init() must be called before F2.removeAllApps()"),void 0)},removeApp:function(instanceId){return _isInit()?(_apps[instanceId]&&(F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_DESTROY_BEFORE,_apps[instanceId]),F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_DESTROY,_apps[instanceId]),F2.AppHandlers.__trigger(_sAppHandlerToken,F2.Constants.AppHandlers.APP_DESTROY_AFTER,_apps[instanceId]),delete _apps[instanceId]),void 0):(F2.log("F2.init() must be called before F2.removeApp()"),void 0)
}}}()),exports.F2=F2,"undefined"!=typeof define&&define.amd&&define(function(){return F2})}}("undefined"!=typeof exports?exports:window);