/*! F2 - v2.0.0 - 04-08-2014 - See below for copyright and license */

!function(window,document,undefined){"use strict";function noop(){}if("function"!=typeof define||!define.amd)throw"F2 did not detect an AMD loader.";("undefined"==typeof console||"undefined"==typeof console.log)&&(console={assert:noop,clear:noop,count:noop,debug:noop,dir:noop,dirxml:noop,error:noop,exception:noop,group:noop,groupCollapsed:noop,groupEnd:noop,info:noop,log:noop,markTimeline:noop,profile:noop,profileEnd:noop,table:noop,time:noop,timeEnd:noop,timeStamp:noop,trace:noop,warn:noop});var F2=function(){},Helpers={},_exports={},_module={exports:{}},_window={document:window.document,XMLHttpRequest:window.XMLHttpRequest,ActiveXObject:window.ActiveXObject,XDomainRequest:window.XDomainRequest};!function(exports,window,f2Window,module){!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("reqwest",this,function(){function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,twoHundo.test(a.request.status)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&"setRequestHeader"in a&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0");return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,"undefined"==typeof j.onreadystatechange||l||(j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),b(lastValue),lastValue=undefined,head.removeChild(j),void(k=1))},head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,c({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null,h=!1;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=d.xhr&&d.xhr(d)||xhr(d),c.open(e,f,d.async===!1?!1:!0),setHeaders(c,d),setCredentials(c,d),win[xDomainRequest]&&c instanceof win[xDomainRequest]?(c.onload=a,c.onerror=b,c.onprogress=function(){},h=!0):c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),h?setTimeout(function(){c.send(g)},200):c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){return a.match("json")?"json":a.match("javascript")?"js":a.match("text")?"html":a.match("xml")?"xml":void 0}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var type=o.type||setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(a,b,c){for(a=self.request,self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function buildParams(a,b,c,d){var e,f,g,h=/\[\]$/;if(isArray(b))for(f=0;b&&f<b.length;f++)g=b[f],c||h.test(a)?d(a,g):buildParams(a+"["+("object"==typeof g?f:"")+"]",g,c,d);else if(b&&"[object Object]"===b.toString())for(e in b)buildParams(a+"["+e+"]",b[e],c,d);else d(a,b)}var win=window,doc=document,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(a){if(a.crossOrigin===!0){var b=win[xmlHttpRequest]?new XMLHttpRequest:null;if(b&&"withCredentials"in b)return b;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(a){return a}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return a=a||function(){},b=b||function(){},this._fulfilled?this._responseArgs.resp=a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a,b){var c,d,e=b||!1,f=[],g=encodeURIComponent,h=function(a,b){b="function"==typeof b?b():null==b?"":b,f[f.length]=g(a)+"="+g(b)};if(isArray(a))for(d=0;a&&d<a.length;d++)h(a[d].name,a[d].value);else for(c in a)a.hasOwnProperty(c)&&buildParams(c,a[c],e,h);return f.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest.ajaxSetup=function(a){a=a||{};for(var b in a)globalSetupOptions[b]=a[b]},reqwest}),exports.reqwest=module.exports,module={exports:{}},function(a){function b(a,c){if(a===c)return!0;if("object"==typeof a&&"object"==typeof c){if(Array.isArray(a)!==Array.isArray(c))return!1;if(Array.isArray(a)){if(a.length!==c.length)return!1;for(var d=0;d<a.length;d++)if(!b(a[d],c[d]))return!1}else{var e;for(e in a)if(c[e]===undefined&&a[e]!==undefined)return!1;for(e in c)if(a[e]===undefined&&c[e]!==undefined)return!1;for(e in a)if(!b(a[e],c[e]))return!1}return!0}return!1}function c(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null}function d(a,b){function d(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return b=c(b||""),a=c(a||""),b&&a?(b.protocol||a.protocol)+(b.protocol||b.authority?b.authority:a.authority)+d(b.protocol||b.authority||"/"===b.pathname.charAt(0)?b.pathname:b.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+b.pathname:a.pathname)+(b.protocol||b.authority||b.pathname?b.search:b.search||a.search)+b.hash:null}function e(a){return a.split("#")[0]}function f(a,b){if(a&&"object"==typeof a)if(b===undefined?b=a.id:"string"==typeof a.id&&(b=d(b,a.id),a.id=b),Array.isArray(a))for(var c=0;c<a.length;c++)f(a[c],b);else if("string"==typeof a.$ref)a.$ref=d(b,a.$ref);else for(var e in a)"enum"!==e&&f(a[e],b)}function g(a,b,c,d,e){if(Error.call(this),a===undefined)throw new Error("No code supplied for error: "+b);this.message=b,this.code=a,this.dataPath=c||"",this.schemaPath=d||"",this.subErrors=e||null;var f=new Error(this.message);if(this.stack=f.stack||f.stacktrace,!this.stack)try{throw f}catch(f){this.stack=f.stack||f.stacktrace}}function h(a,b){if(b.substring(0,a.length)===a){var c=b.substring(a.length);if(b.length>0&&"/"===b.charAt(a.length-1)||"#"===c.charAt(0)||"?"===c.charAt(0))return!0}return!1}function i(a){var b=new j,c=a||"en",g={addFormat:function(){b.addFormat.apply(b,arguments)},language:function(a){return a?(m[a]||(a=a.split("-")[0]),m[a]?(c=a,a):!1):c},addLanguage:function(a,b){var c;for(c in k)b[c]&&!b[k[c]]&&(b[k[c]]=b[c]);var d=a.split("-")[0];if(m[d]){m[a]=Object.create(m[d]);for(c in b)"undefined"==typeof m[d][c]&&(m[d][c]=b[c]),m[a][c]=b[c]}else m[a]=b,m[d]=b;return this},freshApi:function(a){var b=i();return a&&b.language(a),b},validate:function(a,d,e,f){var g=new j(b,!1,m[c],e,f);"string"==typeof d&&(d={$ref:d}),g.addSchema("",d);var h=g.validateAll(a,d,null,null,"");return!h&&f&&(h=g.banUnknownProperties()),this.error=h,this.missing=g.missing,this.valid=null===h,this.valid},validateResult:function(){var a={};return this.validate.apply(a,arguments),a},validateMultiple:function(a,d,e,f){var g=new j(b,!0,m[c],e,f);"string"==typeof d&&(d={$ref:d}),g.addSchema("",d),g.validateAll(a,d,null,null,""),f&&g.banUnknownProperties();var h={};return h.errors=g.errors,h.missing=g.missing,h.valid=0===h.errors.length,h},addSchema:function(){return b.addSchema.apply(b,arguments)},getSchema:function(){return b.getSchema.apply(b,arguments)},getSchemaMap:function(){return b.getSchemaMap.apply(b,arguments)},getSchemaUris:function(){return b.getSchemaUris.apply(b,arguments)},getMissingUris:function(){return b.getMissingUris.apply(b,arguments)},dropSchemas:function(){b.dropSchemas.apply(b,arguments)},reset:function(){b.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:f,resolveUrl:d,getDocumentUri:e,errorCodes:k};return g}Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Object.isFrozen||(Object.isFrozen=function(a){for(var b="tv4_test_frozen_key";a.hasOwnProperty(b);)b+=Math.random();try{return a[b]=!0,delete a[b],!1}catch(c){return!0}});var j=function(a,b,c,d,e){this.missing=[],this.missingMap={},this.formatValidators=a?Object.create(a.formatValidators):{},this.schemas=a?Object.create(a.schemas):{},this.collectMultiple=b,this.errors=[],this.handleError=b?this.collectError:this.returnError,d&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),e&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorMessages=c};j.prototype.createError=function(a,b,c,d,e){var f=this.errorMessages[a]||l[a];if("string"!=typeof f)return new g(a,"Unknown error code "+a+": "+JSON.stringify(b),c,d,e);var h=f.replace(/\{([^{}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a});return new g(a,h,c,d,e)},j.prototype.returnError=function(a){return a},j.prototype.collectError=function(a){return a&&this.errors.push(a),null},j.prototype.prefixErrors=function(a,b,c){for(var d=a;d<this.errors.length;d++)this.errors[d]=this.errors[d].prefixWith(b,c);return this},j.prototype.banUnknownProperties=function(){for(var a in this.unknownPropertyPaths){var b=this.createError(k.UNKNOWN_PROPERTY,{path:a},a,""),c=this.handleError(b);if(c)return c}return null},j.prototype.addFormat=function(a,b){if("object"==typeof a){for(var c in a)this.addFormat(c,a[c]);return this}this.formatValidators[a]=b},j.prototype.resolveRefs=function(a,b){if(a.$ref!==undefined){if(b=b||{},b[a.$ref])return this.createError(k.CIRCULAR_REFERENCE,{urls:Object.keys(b).join(", ")},"","");b[a.$ref]=!0,a=this.getSchema(a.$ref,b)}return a},j.prototype.getSchema=function(a,b){var c;if(this.schemas[a]!==undefined)return c=this.schemas[a],this.resolveRefs(c,b);var d=a,e="";if(-1!==a.indexOf("#")&&(e=a.substring(a.indexOf("#")+1),d=a.substring(0,a.indexOf("#"))),"object"==typeof this.schemas[d]){c=this.schemas[d];var f=decodeURIComponent(e);if(""===f)return this.resolveRefs(c,b);if("/"!==f.charAt(0))return undefined;for(var g=f.split("/").slice(1),h=0;h<g.length;h++){var i=g[h].replace(/~1/g,"/").replace(/~0/g,"~");if(c[i]===undefined){c=undefined;break}c=c[i]}if(c!==undefined)return this.resolveRefs(c,b)}this.missing[d]===undefined&&(this.missing.push(d),this.missing[d]=d,this.missingMap[d]=d)},j.prototype.searchSchemas=function(a,b){if(a&&"object"==typeof a){"string"==typeof a.id&&h(b,a.id)&&this.schemas[a.id]===undefined&&(this.schemas[a.id]=a);for(var c in a)if("enum"!==c)if("object"==typeof a[c])this.searchSchemas(a[c],b);else if("$ref"===c){var d=e(a[c]);d&&this.schemas[d]===undefined&&this.missingMap[d]===undefined&&(this.missingMap[d]=d)}}},j.prototype.addSchema=function(a,b){if("string"!=typeof a||"undefined"==typeof b){if("object"!=typeof a||"string"!=typeof a.id)return;b=a,a=b.id}(a=e(a)+"#")&&(a=e(a)),this.schemas[a]=b,delete this.missingMap[a],f(b,a),this.searchSchemas(b,a)},j.prototype.getSchemaMap=function(){var a={};for(var b in this.schemas)a[b]=this.schemas[b];return a},j.prototype.getSchemaUris=function(a){var b=[];for(var c in this.schemas)(!a||a.test(c))&&b.push(c);return b},j.prototype.getMissingUris=function(a){var b=[];for(var c in this.missingMap)(!a||a.test(c))&&b.push(c);return b},j.prototype.dropSchemas=function(){this.schemas={},this.reset()},j.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},j.prototype.validateAll=function(a,b,c,d,e){var f;if(b=this.resolveRefs(b),!b)return null;if(b instanceof g)return this.errors.push(b),b;var h,i=this.errors.length,j=null,k=null;if(this.checkRecursive&&"object"==typeof a){if(f=!this.scanned.length,a[this.validatedSchemasKey]){var l=a[this.validatedSchemasKey].indexOf(b);if(-1!==l)return this.errors=this.errors.concat(a[this.validationErrorsKey][l]),null}if(Object.isFrozen(a)&&(h=this.scannedFrozen.indexOf(a),-1!==h)){var m=this.scannedFrozenSchemas[h].indexOf(b);if(-1!==m)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[h][m]),null}if(this.scanned.push(a),Object.isFrozen(a))-1===h&&(h=this.scannedFrozen.length,this.scannedFrozen.push(a),this.scannedFrozenSchemas.push([])),j=this.scannedFrozenSchemas[h].length,this.scannedFrozenSchemas[h][j]=b,this.scannedFrozenValidationErrors[h][j]=[];else{if(!a[this.validatedSchemasKey])try{Object.defineProperty(a,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(a,this.validationErrorsKey,{value:[],configurable:!0})}catch(n){a[this.validatedSchemasKey]=[],a[this.validationErrorsKey]=[]}k=a[this.validatedSchemasKey].length,a[this.validatedSchemasKey][k]=b,a[this.validationErrorsKey][k]=[]}}var o=this.errors.length,p=this.validateBasic(a,b,e)||this.validateNumeric(a,b,e)||this.validateString(a,b,e)||this.validateArray(a,b,e)||this.validateObject(a,b,e)||this.validateCombinations(a,b,e)||this.validateFormat(a,b,e)||null;if(f){for(;this.scanned.length;){var q=this.scanned.pop();delete q[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(p||o!==this.errors.length)for(;c&&c.length||d&&d.length;){var r=c&&c.length?""+c.pop():null,s=d&&d.length?""+d.pop():null;p&&(p=p.prefixWith(r,s)),this.prefixErrors(o,r,s)}return null!==j?this.scannedFrozenValidationErrors[h][j]=this.errors.slice(i):null!==k&&(a[this.validationErrorsKey][k]=this.errors.slice(i)),this.handleError(p)},j.prototype.validateFormat=function(a,b){if("string"!=typeof b.format||!this.formatValidators[b.format])return null;var c=this.formatValidators[b.format].call(null,a,b);return"string"==typeof c||"number"==typeof c?this.createError(k.FORMAT_CUSTOM,{message:c}).prefixWith(null,"format"):c&&"object"==typeof c?this.createError(k.FORMAT_CUSTOM,{message:c.message||"?"},c.dataPath||null,c.schemaPath||"/format"):null},j.prototype.validateBasic=function(a,b,c){var d;return(d=this.validateType(a,b,c))?d.prefixWith(null,"type"):(d=this.validateEnum(a,b,c))?d.prefixWith(null,"type"):null},j.prototype.validateType=function(a,b){if(b.type===undefined)return null;var c=typeof a;null===a?c="null":Array.isArray(a)&&(c="array");var d=b.type;"object"!=typeof d&&(d=[d]);for(var e=0;e<d.length;e++){var f=d[e];if(f===c||"integer"===f&&"number"===c&&a%1===0)return null}return this.createError(k.INVALID_TYPE,{type:c,expected:d.join("/")})},j.prototype.validateEnum=function(a,c){if(c["enum"]===undefined)return null;for(var d=0;d<c["enum"].length;d++){var e=c["enum"][d];if(b(a,e))return null}return this.createError(k.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(a):a})},j.prototype.validateNumeric=function(a,b,c){return this.validateMultipleOf(a,b,c)||this.validateMinMax(a,b,c)||null},j.prototype.validateMultipleOf=function(a,b){var c=b.multipleOf||b.divisibleBy;return c===undefined?null:"number"==typeof a&&a%c!==0?this.createError(k.NUMBER_MULTIPLE_OF,{value:a,multipleOf:c}):null},j.prototype.validateMinMax=function(a,b){if("number"!=typeof a)return null;if(b.minimum!==undefined){if(a<b.minimum)return this.createError(k.NUMBER_MINIMUM,{value:a,minimum:b.minimum}).prefixWith(null,"minimum");if(b.exclusiveMinimum&&a===b.minimum)return this.createError(k.NUMBER_MINIMUM_EXCLUSIVE,{value:a,minimum:b.minimum}).prefixWith(null,"exclusiveMinimum")}if(b.maximum!==undefined){if(a>b.maximum)return this.createError(k.NUMBER_MAXIMUM,{value:a,maximum:b.maximum}).prefixWith(null,"maximum");if(b.exclusiveMaximum&&a===b.maximum)return this.createError(k.NUMBER_MAXIMUM_EXCLUSIVE,{value:a,maximum:b.maximum}).prefixWith(null,"exclusiveMaximum")}return null},j.prototype.validateString=function(a,b,c){return this.validateStringLength(a,b,c)||this.validateStringPattern(a,b,c)||null},j.prototype.validateStringLength=function(a,b){return"string"!=typeof a?null:b.minLength!==undefined&&a.length<b.minLength?this.createError(k.STRING_LENGTH_SHORT,{length:a.length,minimum:b.minLength}).prefixWith(null,"minLength"):b.maxLength!==undefined&&a.length>b.maxLength?this.createError(k.STRING_LENGTH_LONG,{length:a.length,maximum:b.maxLength}).prefixWith(null,"maxLength"):null},j.prototype.validateStringPattern=function(a,b){if("string"!=typeof a||b.pattern===undefined)return null;var c=new RegExp(b.pattern);return c.test(a)?null:this.createError(k.STRING_PATTERN,{pattern:b.pattern}).prefixWith(null,"pattern")},j.prototype.validateArray=function(a,b,c){return Array.isArray(a)?this.validateArrayLength(a,b,c)||this.validateArrayUniqueItems(a,b,c)||this.validateArrayItems(a,b,c)||null:null},j.prototype.validateArrayLength=function(a,b){var c;return b.minItems!==undefined&&a.length<b.minItems&&(c=this.createError(k.ARRAY_LENGTH_SHORT,{length:a.length,minimum:b.minItems}).prefixWith(null,"minItems"),this.handleError(c))?c:b.maxItems!==undefined&&a.length>b.maxItems&&(c=this.createError(k.ARRAY_LENGTH_LONG,{length:a.length,maximum:b.maxItems}).prefixWith(null,"maxItems"),this.handleError(c))?c:null},j.prototype.validateArrayUniqueItems=function(a,c){if(c.uniqueItems)for(var d=0;d<a.length;d++)for(var e=d+1;e<a.length;e++)if(b(a[d],a[e])){var f=this.createError(k.ARRAY_UNIQUE,{match1:d,match2:e}).prefixWith(null,"uniqueItems");if(this.handleError(f))return f}return null},j.prototype.validateArrayItems=function(a,b,c){if(b.items===undefined)return null;var d,e;if(Array.isArray(b.items)){for(e=0;e<a.length;e++)if(e<b.items.length){if(d=this.validateAll(a[e],b.items[e],[e],["items",e],c+"/"+e))return d}else if(b.additionalItems!==undefined)if("boolean"==typeof b.additionalItems){if(!b.additionalItems&&(d=this.createError(k.ARRAY_ADDITIONAL_ITEMS,{}).prefixWith(""+e,"additionalItems"),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalItems,[e],["additionalItems"],c+"/"+e))return d}else for(e=0;e<a.length;e++)if(d=this.validateAll(a[e],b.items,[e],["items"],c+"/"+e))return d;return null},j.prototype.validateObject=function(a,b,c){return"object"!=typeof a||null===a||Array.isArray(a)?null:this.validateObjectMinMaxProperties(a,b,c)||this.validateObjectRequiredProperties(a,b,c)||this.validateObjectProperties(a,b,c)||this.validateObjectDependencies(a,b,c)||null},j.prototype.validateObjectMinMaxProperties=function(a,b){var c,d=Object.keys(a);return b.minProperties!==undefined&&d.length<b.minProperties&&(c=this.createError(k.OBJECT_PROPERTIES_MINIMUM,{propertyCount:d.length,minimum:b.minProperties}).prefixWith(null,"minProperties"),this.handleError(c))?c:b.maxProperties!==undefined&&d.length>b.maxProperties&&(c=this.createError(k.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:d.length,maximum:b.maxProperties}).prefixWith(null,"maxProperties"),this.handleError(c))?c:null},j.prototype.validateObjectRequiredProperties=function(a,b){if(b.required!==undefined)for(var c=0;c<b.required.length;c++){var d=b.required[c];if(a[d]===undefined){var e=this.createError(k.OBJECT_REQUIRED,{key:d}).prefixWith(null,""+c).prefixWith(null,"required");if(this.handleError(e))return e}}return null},j.prototype.validateObjectProperties=function(a,b,c){var d;for(var e in a){var f=c+"/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),g=!1;if(b.properties!==undefined&&b.properties[e]!==undefined&&(g=!0,d=this.validateAll(a[e],b.properties[e],[e],["properties",e],f)))return d;if(b.patternProperties!==undefined)for(var h in b.patternProperties){var i=new RegExp(h);if(i.test(e)&&(g=!0,d=this.validateAll(a[e],b.patternProperties[h],[e],["patternProperties",h],f)))return d}if(g)this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]);else if(b.additionalProperties!==undefined){if(this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]),"boolean"==typeof b.additionalProperties){if(!b.additionalProperties&&(d=this.createError(k.OBJECT_ADDITIONAL_PROPERTIES,{}).prefixWith(e,"additionalProperties"),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalProperties,[e],["additionalProperties"],f))return d}else this.trackUnknownProperties&&!this.knownPropertyPaths[f]&&(this.unknownPropertyPaths[f]=!0)}return null},j.prototype.validateObjectDependencies=function(a,b,c){var d;if(b.dependencies!==undefined)for(var e in b.dependencies)if(a[e]!==undefined){var f=b.dependencies[e];if("string"==typeof f){if(a[f]===undefined&&(d=this.createError(k.OBJECT_DEPENDENCY_KEY,{key:e,missing:f}).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(Array.isArray(f))for(var g=0;g<f.length;g++){var h=f[g];if(a[h]===undefined&&(d=this.createError(k.OBJECT_DEPENDENCY_KEY,{key:e,missing:h}).prefixWith(null,""+g).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(d=this.validateAll(a,f,[],["dependencies",e],c))return d}return null},j.prototype.validateCombinations=function(a,b,c){return this.validateAllOf(a,b,c)||this.validateAnyOf(a,b,c)||this.validateOneOf(a,b,c)||this.validateNot(a,b,c)||null},j.prototype.validateAllOf=function(a,b,c){if(b.allOf===undefined)return null;for(var d,e=0;e<b.allOf.length;e++){var f=b.allOf[e];if(d=this.validateAll(a,f,[],["allOf",e],c))return d}return null},j.prototype.validateAnyOf=function(a,b,c){if(b.anyOf===undefined)return null;var d,e,f=[],g=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var h=!0,i=0;i<b.anyOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var j=b.anyOf[i],l=this.errors.length,m=this.validateAll(a,j,[],["anyOf",i],c);if(null===m&&l===this.errors.length){if(this.errors=this.errors.slice(0,g),this.trackUnknownProperties){for(var n in this.knownPropertyPaths)e[n]=!0,delete d[n];for(var o in this.unknownPropertyPaths)e[o]||(d[o]=!0);h=!1;continue}return null}m&&f.push(m.prefixWith(null,""+i).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),h?(f=f.concat(this.errors.slice(g)),this.errors=this.errors.slice(0,g),this.createError(k.ANY_OF_MISSING,{},"","/anyOf",f)):void 0},j.prototype.validateOneOf=function(a,b,c){if(b.oneOf===undefined)return null;var d,e,f=null,g=[],h=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var i=0;i<b.oneOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var j=b.oneOf[i],l=this.errors.length,m=this.validateAll(a,j,[],["oneOf",i],c);if(null===m&&l===this.errors.length){if(null!==f)return this.errors=this.errors.slice(0,h),this.createError(k.ONE_OF_MULTIPLE,{index1:f,index2:i},"","/oneOf");if(f=i,this.trackUnknownProperties){for(var n in this.knownPropertyPaths)e[n]=!0,delete d[n];for(var o in this.unknownPropertyPaths)e[o]||(d[o]=!0)}}else m&&g.push(m.prefixWith(null,""+i).prefixWith(null,"oneOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===f?(g=g.concat(this.errors.slice(h)),this.errors=this.errors.slice(0,h),this.createError(k.ONE_OF_MISSING,{},"","/oneOf",g)):(this.errors=this.errors.slice(0,h),null)},j.prototype.validateNot=function(a,b,c){if(b.not===undefined)return null;var d,e,f=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var g=this.validateAll(a,b.not,null,null,c),h=this.errors.slice(f);return this.errors=this.errors.slice(0,f),this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===g&&0===h.length?this.createError(k.NOT_PASSED,{},"","/not"):null};var k={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,CIRCULAR_REFERENCE:500,UNKNOWN_PROPERTY:1e3},l={INVALID_TYPE:"invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};
g.prototype=Object.create(Error.prototype),g.prototype.constructor=g,g.prototype.name="ValidationError",g.prototype.prefixWith=function(a,b){if(null!==a&&(a=a.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+a+this.dataPath),null!==b&&(b=b.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+b+this.schemaPath),null!==this.subErrors)for(var c=0;c<this.subErrors.length;c++)this.subErrors[c].prefixWith(a,b);return this};var m={},n=i();n.addLanguage("en-gb",l),n.tv4=n,"undefined"!=typeof module&&module.exports?module.exports=n:a.tv4=n}(this),exports.tv4=module.exports,module={exports:{}}}.call(_window,_exports,_window,window,_module={exports:{}});var tv4=_exports.tv4,reqwest=_exports.reqwest;_exports=undefined,function(){Helpers._={defaults:function(a){return Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},extend:function(a){return Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a},isArray:function(a){return Array.isArray?Array.isArray(a):"[object Array]"==Object.prototype.toString.call(a)},isFunction:function(a){return"function"==typeof a},isNode:function(a){return a&&1===a.nodeType},isString:function(a){return"string"==typeof a},isObject:function(a){return a===Object(a)},pluck:function(a,b){for(var c=[],d=0;d<a.length;d++)a[d]&&a[d][b]&&c.push(a[d][b]);return c},unique:function(a){if(!a)return[];for(var b=[],c=[],d=0,e=a.length;e>d;d++){var f=a[d];f&&-1===b.indexOf(f)&&b.push(f),c.push(f)}return b}}}(),function(_){function loadDependencies(a,b,c){_.isFunction(a.loadDependencies)?a.loadDependencies(b,c):(b.forEach(function(a){require.config({paths:a})}),c())}function loadInlineScripts(inlines,callback){if(inlines.length)try{eval(inlines.join(";"))}catch(e){console.error("Error loading inline scripts: "+e)}callback()}function loadScripts(a,b,c){_.isFunction(a.loadScripts)?a.loadScripts(b,c):require(b,function(){c()})}function loadStyles(a,b,c){if(_.isFunction(a.loadStyles))a.loadStyles(b,c);else{for(var d=document.getElementsByTagName("head")[0],e=0;e<b.length;e++){var f=document.createElement("link");f.rel="stylesheet",f.href=b[e],f.async=!1,d.appendChild(f)}c()}}Helpers.LoadStaticFiles={load:function(a,b,c,d,e,f){loadStyles(a,b,function(){loadScripts(a,c,function(){loadDependencies(a,e,function(){loadInlineScripts(d,function(){f()})})})})}}}(Helpers._),function(a){function b(a){return-1===a.indexOf("?")?"?":"&"}function c(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null}function d(a,b){function d(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return b=c(b||""),a=c(a||""),b&&a?(b.protocol||a.protocol)+(b.protocol||b.authority?b.authority:a.authority)+d(b.protocol||b.authority||"/"===b.pathname.charAt(0)?b.pathname:b.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+b.pathname:a.pathname)+(b.protocol||b.authority||b.pathname?b.search:b.search||a.search)+b.hash:null}function e(a){var b,c,e=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,f=a.toLowerCase(),g=e.exec(f);try{b=location.href}catch(h){b=document.createElement("a"),b.href="",b=b.href}b=b.toLowerCase(),g||(f=d(b,f).toLowerCase(),g=e.exec(f)),c=e.exec(b)||[];var i=!(g&&(g[1]!==c[1]||g[2]!==c[2]||(g[3]||("http:"===g[1]?"80":"443"))!==(c[3]||("http:"===c[1]?"80":"443"))));return i}function f(){return Math.floor(1e6*Math.random())}Helpers.Ajax={request:function(c,d){if(!c.url)throw"F2.Ajax: you must provide a url.";c.crossOrigin=!e(c.url);var g=-1!==c.url.indexOf(".json")||-1!==c.url.indexOf(".js");c.method||(c.crossOrigin?c.type="jsonp":c.method=g?"get":"post"),c.type||(c.type="json"),"get"!==c.method&&"jsonp"!==c.type||d||(c.url+=b(c.url)+f()),"jsonp"===c.type&&(c.jsonpCallbackName="F2_"+f(),window[c.jsonpCallbackName]=function(a){c.success&&c.success(a),c.complete&&c.complete(),delete window[c.jsonpCallbackName]});var h=a(c);return{isAborted:!1,abort:function(){this.isAborted=!0,h.request.abort()}}}}}(reqwest),function(){function a(a){var b,d;if(a){var e=a.getAttribute("data-f2-appid"),f=a.getAttribute("data-f2-manifesturl");if(e&&f){d={appId:e,manifestUrl:f};var g=a.getAttribute("data-f2-context");if(g)try{d.context=JSON.parse(g)}catch(h){console.warn('F2: "data-f2-context" of node is not valid JSON','"'+h+'"')}}}if(d){var i=c(a);b={appConfig:d,isPreload:i,node:a}}return b}function b(a,b){var c=[];return a.getAttribute(b)||(a=a.firstChild),function d(a){for(;a;)1===a.nodeType&&a.getAttribute(b)&&c.push(a),a.hasChildNodes()&&d(a.firstChild),a=a.nextSibling}(a),c}function c(a){var b=!1;if(a.hasChildNodes())for(var c=0,d=a.childNodes.length;d>c;c++)if(1===a.childNodes[c].nodeType){b=!0;break}return b}Helpers.AppPlaceholders={getInNode:function(c){for(var d=[],e=b(c,"data-f2-appid"),f=0,g=e.length;g>f;f++){var h=a(e[f]);h&&d.push(h)}return d}}}(),function(){var a={},b={};Helpers.Guid={guid:function(){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a[b]&&(b=this.guid()),a[b]=!0,b},isTrackedGuid:function(a){return b[a]},trackedGuid:function(){var a=this.guid();return b[a]=!0,a}}}(),function(){F2.prototype.Constants={EVENTS:{APP_SYMBOL_CHANGE:"__appSymbolChange__",APP_WIDTH_CHANGE:"__appWidthChange__",CONTAINER_SYMBOL_CHANGE:"__containerSymbolChange__",CONTAINER_WIDTH_CHANGE:"__containerWidthChange__"},VIEWS:{ABOUT:"about",DATA_ATTRIBUTE:"data-f2-view",HELP:"help",HOME:"home",REMOVE:"remove",SETTINGS:"settings"}}}(),function(a,b){var c={BAD_NAME:function(){return"F2.Schemas: you must provide a string schema name."},BAD_JSON:function(){return"F2.Schemas: you must provide a schema."},DUPE_SCHEMA:function(a){return'F2.Schemas: "'+a+'" is already a registered schema.'},NO_SCHEMA:function(a){return'F2.Schemas: "'+a+'" is not a registered schema.'}};F2.prototype.addSchema=function(d,e){if(!b.isString(d))throw c.BAD_NAME();if(Helpers.hasSchema(d))throw c.DUPE_SCHEMA(d);if(!b.isObject(e))throw c.BAD_JSON();return a.addSchema(d,e),!0},F2.prototype.hasSchema=Helpers.hasSchema=function(d){if(!b.isString(d))throw c.BAD_NAME();return!!a.getSchema(d)},F2.prototype.validate=Helpers.validate=function(d,e){if(!b.isString(e))throw c.BAD_NAME();if(!Helpers.hasSchema(e))throw c.NO_SCHEMA(e);if(!b.isObject(d))throw c.BAD_JSON();var f=a.getSchema(e);return a.validate(d,f)};var d={appConfig:{id:"appConfig",title:"App Config",type:"object",properties:{appId:{type:"string"},context:{type:"object"},manifestUrl:{type:"string"},enableBatchRequests:{type:"boolean"},views:{type:"array",items:{type:"string"}}},required:["appId"]},appManifest:{id:"appManifest",title:"App Manifest",type:"object",properties:{scripts:{type:"array",items:{type:"string"}},styles:{type:"array",items:{type:"string"}},inlineScripts:{type:"array",items:{type:"string"}},error:{type:"object"},data:{type:"object"},html:{type:"string"}},required:["scripts","styles","inlineScripts"]},uiModalParams:{id:"uiModalParams",title:"F2.UI Modal Parameters",type:"object",properties:{buttons:{type:"array",items:{type:"object",properties:{label:{type:"string"},handler:{type:"function"}},required:["label","handler"]}},content:{type:"string"},onClose:{type:"function"},title:{type:"string"}}}};for(var e in d)a.addSchema(e,d[e])}(tv4,Helpers._),function(a,b,c,d){function e(a){var c;if(r[a])c=r[a];else if(r[a.instanceId])c=r[a.instanceId];else if(b.isNode(a))for(var d in r)if(r[d].root===a){c=r[d];break}return c}function f(a){for(var d=[],e=[],f=[],g=0;g<a.length;g++){var h=Helpers.validate(a[g],"appConfig"),i=a[g].isPreload&&b.isNode(a[g].root),j=b.isString(a[g].manifestUrl);h&&(i||j)?i?f.push({appConfig:a[g],data:a[g].context||{},index:g,instanceId:c.guid(),root:a[g].root}):j&&d.push({appConfig:a[g],index:g,instanceId:c.guid(),isAborted:!1,isFailed:!1}):e.push({appConfig:a[g],error:"Invalid app config",index:g})}return{async:d,broken:e,preloaded:f}}function g(a){for(var b={},c=0;c<a.length;c++){var d=a[c].appConfig;b[d.manifestUrl]||(b[d.manifestUrl]={batch:[],singles:[]}),d.enableBatchRequests?b[d.manifestUrl].batch.push(a[c]):b[d.manifestUrl].singles.push(a[c])}return b}function h(a,c,e){var f=[];if(c.length){var h=g(c),i=0,j=[];for(var m in h){var n=h[m],o=n.singles.slice();n.batch.length&&o.push(n.batch),i+=o.length,o.forEach(function(c){c=[].concat(c);var g=b.pluck(c,"appConfig"),h=l(m,g,function(h){if(h.forEach(function(a,d){a.error?c.forEach(function(a){a.isFailed=!0}):(b.defaults({},a,u),a.appConfig=g[d],c[d].data=a.data,c[d].html=a.html)}),j=j.concat(h),!--i){var l=k(j);d.load(a,l.styles,l.scripts,l.inlineScripts,l.dependencies,function(){f.forEach(function(a){a.xhr.isAborted&&a.apps.forEach(function(a){a.isAborted=!0})}),e()})}});f.push({apps:c,xhr:h})})}}else e();return f}function i(a){return a&&a.trim()}function j(a,b){if(!b||!b.trim())return null;if(-1!==b.indexOf("//"))return b;a=a.substr(0,a.lastIndexOf("/")+1);var c=new RegExp(/^(\.\/)+/i),d=c.exec(b);if(d)b=b.substr(2);else{var e=new RegExp(/^(\.\.\/)+/i),f=e.exec(b);if(f&&f.length)for(var g=0;g<f.length-1;g++){var h=a.lastIndexOf("/"),i=a.lastIndexOf("/",h-1);a=a.substr(0,i+1),b=b.substr(3)}}return a+b}function k(a){var c=[],d=[],e=[],f=[];if(a.length){for(var g=0;g<a.length;g++)a[g].error||(b.isObject(a[g].dependencies)&&c.push(a[g].dependencies),b.isArray(a[g].inlineScripts)&&a[g].inlineScripts.length&&d.push(a[g].inlineScripts),b.isArray(a[g].scripts)&&a[g].scripts.length&&(a[g].scripts=a[g].scripts.map(function(b){return j(a[g].appConfig.manifestUrl,b)}),e.push(a[g].scripts)),b.isArray(a[g].styles)&&a[g].styles.length&&(a[g].styles=a[g].styles.map(function(b){return j(a[g].appConfig.manifestUrl,b)}),f.push(a[g].styles)));c=Array.prototype.concat.apply([],c),d=Array.prototype.concat.apply([],d),e=Array.prototype.concat.apply([],e),f=Array.prototype.concat.apply([],f),d=b.unique(d),e=b.unique(e),f=b.unique(f),d=d.filter(i),e=e.filter(i),f=f.filter(i)}return{dependencies:c,inlineScripts:d,scripts:e,styles:f}}function l(c,d,e){var f={error:"Invalid app manifest"},g=d.map(function(a){var c={appId:a.appId};return b.isObject(a.context)&&(c.context=a.context),c});return a.request({data:{params:JSON.stringify(g)},error:function(){e([f])},success:function(a){a&&b.isArray(a)||(a=[a||{}]);for(var c=0;c<a.length;c++)a[c]&&Helpers.validate(a[c],"appManifest")||(a[c]=f);e(a)},type:"json",url:c})}function m(a,b){if(a.length){var c=a.map(function(a){return define(a.appConfig.appId,[],function(){return function(){console.error('F2: the app "'+a.appConfig.appId+'" was never defined and could not be loaded.',"Did you forget to include a script file?")}}),a.appConfig.appId});require(c,function(){var c=Array.prototype.slice.call(arguments);a.forEach(function(b,d){try{s[b.instanceId]=!0;var e=new c[d](b.instanceId,b.appConfig,b.data,b.root);if(delete s[b.instanceId],!e)throw new Error;if(r[b.instanceId]={appConfig:b.appConfig,instance:e,instanceId:b.instanceId,root:b.root},t[b.instanceId]){for(;t[b.instanceId].length;)t[b.instanceId].shift()(e);delete t[b.instanceId]}e.init&&e.init()}catch(f){a[d]={error:f.toString()},console.error("F2: could not init",b.appConfig.appId,'"'+f.toString()+'"')}}),b()})}else b()}function n(a){var b={appConfig:a.appConfig};return a.isFailed?b.error="App request failed":a.isAborted?b.error="App request was aborted":(b.data=a.data||{},b.root=a.root,b.instanceId=a.instanceId),b}function o(a){return!a.error&&!a.isAborted&&!a.isFailed}function p(a){if(a.appConfig.root)a.root=a.appConfig.root,a.root.innerHTML=a.html||"";else if(a.html&&a.html.trim()){var b=document.createElement("div");b.innerHTML=a.html,a.root=b.firstChild}}function q(a,b){var c=document.createDocumentFragment();a.forEach(function(a){a.isFailed||a.isAborted||a.root&&c.appendChild(a.root)}),b.appendChild(c)}var r={},s={},t={},u={data:{},dependencies:{},html:"",inlineScripts:[],scripts:[],styles:[]};Helpers.LoadApps={isRealInstanceId:function(a){return!!s[a]},getLoadedApp:function(a){return a?e(a):null},isLoadedApp:function(a){return!!this.getLoadedApp(a)},addLoadListener:function(a,b){t[a]||(t[a]=[]),t[a].push(b)},load:function(a,b,c){var d=f(b);return h(a,d.async,function(){var a=[].concat(d.async,d.preloaded,d.broken);a.sort(function(a,b){return a.index-b.index});var b=a.filter(o);d.async.length&&d.async.forEach(p),m(b,function(){if(c){var b=a.map(n);c(b)}else q(d.async,document.body)})})},remove:function(a){delete r[a]}}}(Helpers.Ajax,Helpers._,Helpers.Guid,Helpers.LoadStaticFiles),function(a,b,c){function d(a,b){for(var c=0;c<b.length;c++){if("*"===b[c])return!0;if(a.instanceId===b[c]||a.appConfig.appId===b[c])return!0;var d=new RegExp(b[c],"gi");if(d.test(a.appConfig.appId))return!0}return!1}function e(b,c,e){if(!b||!a.isString(b))throw new TypeError("F2: You need to provide an event name to emit.");if(e&&a.isArray(e)&&!e.every(a.isString))throw new TypeError('F2: Your "emit" filters must either be an AppId or an InstanceId.');if(h[b]){for(var f=0;f<h[b].length;f++){var g=h[b][f];(!e||d(g.instance,e))&&g.handler.apply(g.instance,c),g.timesLeft!==undefined&&0===--g.timesLeft&&h[b].splice(f--,1)}h[b].length||delete h[b]}}function f(a,d,e,g){var i=a&&b.isRealInstanceId(a.instanceId);if(!a)throw new TypeError('F2: Your "instance" must be an app loaded via F2 or the container token.');if(!i){var j=b.isLoadedApp(a),k=c.isTrackedGuid(a);if(!j&&!k)throw new TypeError('F2: Your "instance" must be an app loaded via F2 or the container token.')}if(!d)throw new TypeError('F2: You must provide the "name" of the event to which you\'re subscribing.');if(!e)throw new TypeError('F2: You must provide a "handler" that will fire when your event is triggered.');if(g!==undefined&&isNaN(g)||1>g)throw new TypeError('F2: If passed, "timesToListen" must be a number greater than 0.');h[d]||(h[d]=[]),i?b.addLoadListener(a.instanceId,function(a){f(a,d,e,g)}):h[d].push({handler:e,instance:a,timesLeft:g})}function g(d,e,f){var i,j,k,l,m=f&&a.isFunction(f),n=d&&(b.isLoadedApp(d)||c.isTrackedGuid(d));if(!m&&!n)throw new TypeError('F2: The "off" function requires an app instance, InstanceId, or the container token');if(e&&!a.isString(e))throw new TypeError('F2: If passed, "name" must be a string.');if(l=h[e],e&&l)for(i=l.length-1;i>=0;--i)j=l[i].instance===d,k=l[i].handler===f,(j&&!m||m&&k)&&l.splice(i,1),0===l.length&&delete h[e];else for(var o in h)g(d,o,f)}var h={};F2.prototype.emit=function(b,c){var d=Array.prototype.slice.call(arguments,2);return a.isString(b)&&(c=b,b=["*"],d=Array.prototype.slice.call(arguments,1)),e(c,d,b)},F2.prototype.off=function(a,b,c){g(a,b,c)},F2.prototype.on=function(a,b,c,d){f(a,b,c,d)}}(Helpers._,Helpers.LoadApps,Helpers.Guid),function(a,b,c,d){function e(){throw"F2: onetime token has already been used."}var f={loadDependencies:null,loadInlineScripts:null,loadScripts:null,loadStyles:null,ui:{modal:null,toggleLoading:null}};F2.prototype.config=function(a){return b.isObject(a)&&((!a.loadDependencies||b.isFunction(a.loadDependencies))&&(f.loadDependencies=a.loadDependencies),(!a.loadInlineScripts||b.isFunction(a.loadInlineScripts))&&(f.loadInlineScripts=a.loadInlineScripts),(!a.loadScripts||b.isFunction(a.loadScripts))&&(f.loadScripts=a.loadScripts),(!a.loadStyles||b.isFunction(a.loadStyles))&&(f.loadStyles=a.loadStyles),b.isObject(a.ui)&&(f.ui||(f.ui={}),(!a.ui.modal||b.isFunction(a.ui.modal))&&(f.ui.modal=a.ui.modal),(!a.ui.toggleLoading||b.isFunction(a.ui.toggleLoading))&&(f.ui.toggleLoading=a.ui.toggleLoading))),f},F2.prototype.guid=function(){return c.guid()},F2.prototype.load=function(c,d){if(!b.isArray(c)||!c.length)throw'F2: no appConfigs passed to "load"';b.isFunction(d)||(d=noop),this.onetimeToken!==e&&this.onetimeToken();var f=a.load(this.config(),c,d);return{abort:function(){for(var a=0;a<this.requests.length;a++)this.requests[a].xhr.abort()},requests:f||[]}},F2.prototype.loadPlaceholders=function(a,c){a&&b.isNode(a)||(a=document.body),c&&b.isFunction(c)||(c=noop);var e=d.getInNode(a);if(e.length){var f=e.map(function(a){return a.appConfig.isPreload=a.isPreload,a.appConfig.root=a.node,a.appConfig});this.load(f,function(a){a.forEach(function(a,b){a.error||e[b].isPreload||e[b].node.parentNode.replaceChild(a.root,e[b].node)}),c(a)})}else console.warn("F2: no placeholders were found inside",a),c([])},F2.prototype.new=function(){return function(a){return new F2(a)}()},F2.prototype.onetimeToken=function(){return this.onetimeToken=e,c.trackedGuid()},F2.prototype.unload=function(b){var c=Array.prototype.slice.apply(arguments);b=c.length>1?c:[].concat(b);for(var d=0;d<b.length;d++){var e=b[d];if(!e)throw"F2: you must provide an instanceId, root, or app instance to remove an app";e.instanceId&&(e=e.instanceId);var f=a.getLoadedApp(e);f&&f.instanceId?(f.instance.dispose&&f.instance.dispose(),this.off(f.instance),f.root&&f.root.parentNode&&f.root.parentNode.removeChild(f.root),a.remove(f.instanceId)):console.warn("F2: could not find an app to remove")}}}(Helpers.LoadApps,Helpers._,Helpers.Guid,Helpers.AppPlaceholders),function(a){F2.prototype.UI={modal:function(b){var c=F2.prototype.config.call(this);c.ui&&a.isFunction(c.ui.modal)?a.isObject(b)&&F2.prototype.validate.call(this,b,"uiModalParams")?c.ui.modal(b):console.error("F2.UI: The parameters to ui.modal are incorrect."):console.error("F2.UI: The container has not defined ui.modal.")},toggleLoading:function(b){var c=F2.prototype.config.call(this);c.ui&&a.isFunction(c.ui.toggleLoading)?!b||b&&1===b.nodeType?c.ui.toggleLoading(b):console.error("F2.UI: the root passed was not a native DOM node."):console.error("F2.UI: The container has not defined ui.toggleLoading.")}}}(Helpers._),define("F2.AppClass",["F2"],function(a){var b=function(a,b,c,d){this.instanceId=a,this.appConfig=b,this.context=c,this.root=d};return b.prototype={dispose:function(){},events:{many:function(b,c,d){return a.Events.many(b,c,d,this)},off:function(b,c){return a.off(b,c,this)},on:function(b,c){return a.on(b,c,this)},once:function(b,c){return a.once(b,c,this)}},reload:function(b){var c=this;_.extend(this.appConfig.context,b),a.load(this.appConfig).then(function(b){b.root=c.root,a.unload(c.instanceId)})}},b}),define("F2",[],function(){return new F2})}(window,document);
//# sourceMappingURL=f2.min.map